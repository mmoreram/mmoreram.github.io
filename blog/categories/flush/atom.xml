<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: flush | Because yes]]></title>
  <link href="http://mmoreram.com/blog/categories/flush/atom.xml" rel="self"/>
  <link href="http://mmoreram.com/"/>
  <updated>2017-02-04T14:15:07+01:00</updated>
  <id>http://mmoreram.com/</id>
  <author>
    <name><![CDATA[Marc Morera]]></name>
    <email><![CDATA[yuhu@mmoreram.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Flushing Doctrine2 entities]]></title>
    <link href="http://mmoreram.com/blog/2013/10/11/flushing-doctrine2-entities/"/>
    <updated>2013-10-11T10:11:00+02:00</updated>
    <id>http://mmoreram.com/blog/2013/10/11/flushing-doctrine2-entities</id>
    <content type="html"><![CDATA[<p>Given this example</p>

<p>``` php
$spain = new Country;
$spain->setName(&lsquo;spain&rsquo;);
$entityManager->persist($spain);</p>

<p>$france = new Country;
$france->setName(&lsquo;france&rsquo;);
$entityManager->persist($france);</p>

<p>$entityManager->flush();
```</p>

<p>When we flush without defining any kind of parameter, all entities managed by
EntityManager with changes will be flushed.<br/>
To flush a specific entity managed by EntityManager we can just pass the entity
as a parameter in the flush method</p>

<p>``` php
$spain = new Country;
$spain->setName(&lsquo;spain&rsquo;);
$entityManager->persist($spain);</p>

<p>$france = new Country;
$france->setName(&lsquo;france&rsquo;);
$entityManager->persist($france);</p>

<p>/<em>*
 * At this point, I only want to flush $spain
 </em>/
$entityManager->flush($spain);
```</p>

<p>To flush an array of entities managed by EntityManager we can pass the array as
a parameter in the flush method</p>

<p>``` php
$spain = new Country;
$spain->setName(&lsquo;spain&rsquo;);
$entityManager->persist($spain);</p>

<p>$france = new Country;
$france->setName(&lsquo;france&rsquo;);
$entityManager->persist($france);</p>

<p>$germany = new Country;
$germany->setName(&lsquo;germany&rsquo;);
$entityManager->persist($germany);</p>

<p>/<em>*
 * At this point, I only want to flush $spain
 </em>/
$entityManager->flush(array(</p>

<pre><code>$spain,
$france,
</code></pre>

<p>));
```</p>

<p>So, how about flushing an ArrayCollection of entities? Lets take a look at the
UnitOfWork code where contains this logic.</p>

<p>``` php
if ($entity === null) {</p>

<pre><code>$this-&gt;computeChangeSets();
</code></pre>

<p>} elseif (is_object($entity)) {</p>

<pre><code>$this-&gt;computeSingleEntityChangeSet($entity);
</code></pre>

<p>} elseif (is_array($entity)) {</p>

<pre><code>foreach ($entity as $object) {
    $this-&gt;computeSingleEntityChangeSet($object);
}
</code></pre>

<p>}
```</p>

<p>Considering that ArrayCollection is an object, this code should be changed to
this code to also accept ArrayCollection and all iterable objects.</p>

<p>``` php
if ($entity === null) {</p>

<pre><code>$this-&gt;computeChangeSets();
</code></pre>

<p>} elseif (is_array($entity) || $entity instanceof IteratorAggregate) {</p>

<pre><code>foreach ($entity as $object) {
    $this-&gt;computeSingleEntityChangeSet($object);
}
</code></pre>

<p>} elseif (is_object($entity)) {</p>

<pre><code>$this-&gt;computeSingleEntityChangeSet($entity);
</code></pre>

<p>}
```</p>
]]></content>
  </entry>
  
</feed>
