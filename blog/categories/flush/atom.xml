<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: flush | Because yes]]></title>
  <link href="http://mmoreram.github.io/blog/categories/flush/atom.xml" rel="self"/>
  <link href="http://mmoreram.github.io/"/>
  <updated>2013-10-11T10:14:45+02:00</updated>
  <id>http://mmoreram.github.io/</id>
  <author>
    <name><![CDATA[Marc Morera]]></name>
    <email><![CDATA[yuhu@mmoreram.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Flushing Doctrine2 entities]]></title>
    <link href="http://mmoreram.github.io/blog/2013/10/11/flushing-doctrine2-entities/"/>
    <updated>2013-10-11T10:11:00+02:00</updated>
    <id>http://mmoreram.github.io/blog/2013/10/11/flushing-doctrine2-entities</id>
    <content type="html"><![CDATA[<p>ven this example</p>

<pre><code>$spain = new Country;
$spain-&gt;setName('spain');
$entityManager-&gt;persist($spain);

$france = new Country;
$france-&gt;setName('france');
$entityManager-&gt;persist($france);

$entityManager-&gt;flush();
</code></pre>

<p>When we flush without defining any kind of parameter, all entities managed by EntityManager with changes will be flushed.<br/>
To flush a specific entity managed by EntityManager we can just pass the entity as a parameter in the flush method</p>

<pre><code>$spain = new Country;
$spain-&gt;setName('spain');
$entityManager-&gt;persist($spain);

$france = new Country;
$france-&gt;setName('france');
$entityManager-&gt;persist($france);

/**
 * At this point, I only want to flush $spain
 */
$entityManager-&gt;flush($spain);
</code></pre>

<p>To flush an array of entities managed by EntityManager we can pass the array as a parameter in the flush method</p>

<pre><code>$spain = new Country;
$spain-&gt;setName('spain');
$entityManager-&gt;persist($spain);

$france = new Country;
$france-&gt;setName('france');
$entityManager-&gt;persist($france);

$germany = new Country;
$germany-&gt;setName('germany');
$entityManager-&gt;persist($germany);

/**
 * At this point, I only want to flush $spain
 */
$entityManager-&gt;flush(array(
    $spain,
    $france,
));
</code></pre>

<p>So, how about flushing an ArrayCollection of entities? Lets take a look at the UnitOfWork code where contains this logic.</p>

<pre><code>if ($entity === null) {
    $this-&gt;computeChangeSets();

} elseif (is_object($entity)) {

    $this-&gt;computeSingleEntityChangeSet($entity);
} elseif (is_array($entity)) {

    foreach ($entity as $object) {
        $this-&gt;computeSingleEntityChangeSet($object);
    }
}
</code></pre>

<p>Considering that ArrayCollection is an object, this code should be changed to this code to also accept ArrayCollection and all iterable objects.</p>

<pre><code>if ($entity === null) {
    $this-&gt;computeChangeSets();

} elseif (is_array($entity) || $entity instanceof IteratorAggregate) {

    foreach ($entity as $object) {
        $this-&gt;computeSingleEntityChangeSet($object);
    }
} elseif (is_object($entity)) {

    $this-&gt;computeSingleEntityChangeSet($entity);
}
</code></pre>
]]></content>
  </entry>
  
</feed>
