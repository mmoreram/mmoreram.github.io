
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Because yes</title>
  <meta name="author" content="Marc Morera">

  
  <meta name="description" content="Este problema ocurre en proyectos abiertos, open source. Para proyectos privados
donde Cart siempre será Cart, no creo que deba ser de su &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mmoreram.github.io/blog/page/4/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Because yes" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=Raleway:100" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic|Istok+Web:400,400italic,700,700italic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-41917921-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
  <div id="header-container">
    <div id="header">
      <div class="wrapper">
        <header role="banner"><hgroup>
  <h1><a href="/">Because yes</a></h1>
</hgroup>

</header>
        <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mmoreram.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
      </div>
    </div>
  </div>
  <div id="body"   >
    <div id="main">
      <div id="content">
	<div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/05/paramconverter-una-mala-idea/">ParamConverter&#8230; Mala Idea</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-05T13:18:00+02:00" pubdate data-updated="true">May 5<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/05/05/paramconverter-una-mala-idea/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Este problema ocurre en proyectos abiertos, open source. Para proyectos privados
donde Cart siempre será Cart, no creo que deba ser de su preocupación.</p>

<p>Cada vez tenemos más en mente trabajar con módulos que sean reutilizables. Las
buenas prácticas pasan por trabajar con interfaces y dar pie a que, el usuario
que tan amablemente está reutilizando nuestro código, pueda definir su dominio
según su especificación. Esto pasa, claro, por pensar que una entidad no siempre
será la misma entidad, el mismo objeto.</p>

<p>Me explicaré.</p>

<p>La buena práctica sugiere que cuando definimos una entidad con sus relaciones,
utilizemos un ResolveTargetEntityListener. Lo que hace este listener es, una vez
se han definido las relaciones utilizando interfaces, se resuelven éstas y se
sustituyen por entidades reales ( evidentemente por entidades que implementan
tales interfaces ).</p>

<p>Cuando se sigue esta estrategia, es natural definir tanto el namespace como
el factory de la entidad que estás utilizando en un parámetro de bundle, por lo
que se puede sobrescribir fácilmente en cada uno de los proyectos.</p>

<p>Vemos un ejemplo.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">Elcodi\CartBundle\Entity\Cart</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">entity</span>
</span><span class='line'>    <span class="l-Scalar-Plain">repositoryClass</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\CartBundle\Repository\CartRepository</span>
</span><span class='line'>    <span class="l-Scalar-Plain">table</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">cart</span>
</span><span class='line'>
</span><span class='line'>    <span class="l-Scalar-Plain">oneToOne</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">order</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="l-Scalar-Plain">targetEntity</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\CartBundle\Entity\Interfaces\OrderInterface</span>
</span><span class='line'>            <span class="l-Scalar-Plain">mappedBy</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">cart</span>
</span></code></pre></td></tr></table></div></figure>


<p>En este caso, la relación con Order es débil, ya que la proponemos con cualquier
entidad que implemente OrderInterface. Solo hace falta que el
ResolveTargetEntityListener proponga una implementación para OrderInterface, en
nuestro caso, <code>Elcodi\CartBundle\Entity\Order</code>.</p>

<p>En nuestro config, definimos los namespaces de las entidades con las que vamos a
trabajar.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># Entities</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="l-Scalar-Plain">elcodi.core.cart.entity.cart.class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\CartBundle\Entity\Cart</span>
</span><span class='line'>    <span class="l-Scalar-Plain">elcodi.core.cart.entity.order.class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\CartBundle\Entity\Order</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># Factories</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="l-Scalar-Plain">elcodi.core.cart.factory.cart.class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\CartBundle\Factory\CartFactory</span>
</span><span class='line'>    <span class="l-Scalar-Plain">elcodi.core.cart.factory.order.class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\CartBundle\Factory\OrderFactory</span>
</span></code></pre></td></tr></table></div></figure>


<p>Este escenario anuncia lo que el título de este post enuncia. Hardcodear el
namespace de una entidad en alguna parte, rompe toda esta estrategia. Si
trabajamos de esta forma &ldquo;abstracta&rdquo; no nos podemos permitir el lujo de marcar
con sangre que una entidad siempre será de un tipo específico, y es, en
realidad, lo que obliga el ParamConverter</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">use</span> <span class="nx">Sensio\Bundle\FrameworkExtraBundle\Configuration\Route</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Sensio\Bundle\FrameworkExtraBundle\Configuration\ParamConverter</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @Route(&quot;/cart/{id}&quot;)</span>
</span><span class='line'><span class="sd"> * @ParamConverter(&quot;cart&quot;, class=&quot;ElcodiCartBundle:Cart&quot;)</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Proposición</p>

<p>Para que el ParamConverter funcionara de tal forma que pudiéramos salvar este
problema, deberíamos poder definir nuestra entidad con un parameter. Algo así:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">use</span> <span class="nx">Sensio\Bundle\FrameworkExtraBundle\Configuration\Route</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Sensio\Bundle\FrameworkExtraBundle\Configuration\ParamConverter</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @Route(&quot;/cart/{id}&quot;)</span>
</span><span class='line'><span class="sd"> * @ParamConverter(&quot;cart&quot;, class=&quot;%elcodi.core.cart.entity.cart.class%&quot;)</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Esto implica que se debería inyectar el Container entero en el servicio que
trabaja los paramconverter de Doctrine, y que deberíamos checkear siempre si
el parámetro que se pasa es un namespace o un nombre de un parámetro.</p>

<p>Tal vez tendría sentido poder trabajar con ExpressionLanguage, pero el problema
es que añades una relación mas al bundle, por lo que no creo que les guste a los
autores del bundle ( SensioLabs ).</p>

<p>Con este post no quiero abrir un debate sobre si las annotations están bien o
no. Soy el primero que las he defendido en su momento, otorgando siempre su
utilidad en ciertos entornos y en ciertos casos. Ahora que empiezo a trabajar en
un entorno 100% OpenSource ya no valen tanto como antes.</p>

<p>Que creéis al respecto? Olvidaríais las annotations al 100 en entornos Open
Source?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/29/elcodi-a-new-symfony-adventure/">Elcodi, a New Symfony Adventure</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-29T16:10:00+02:00" pubdate data-updated="true">Apr 29<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/04/29/elcodi-a-new-symfony-adventure/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some changes are about to come. And it seems that they are good
changes. I haven’t written in my blog for a few weeks, and the truth is
I feel bad about it. I like to write about the things that happen to me at
the company; about the problems we find and the solutions I come up
with. The thing is that, for some months now, I’ve been really focused
on the project that we are launching to the world today. Initially, it is
a project by developers for developers, focused on meeting the actual
needs of developers who design and program e-commerce.</p>

<p>It is true that we have plenty of platforms and options to develop e-
commerce around the world. I could name a few, and probably they all
have outstanding metrics and KPIs.</p>

<p>The problem with these platforms is that they are entirely B2B, so
they only make sense when the end user just needs to have a good
management, installation and configuration interface; and when
technical departments want to develop, both horizontally (new features
for things already in use, or just customization) and vertically (new
features), these B2B platforms fall short, and so the company must
either pay a lot of money in refactoring, or the existing code must be
touched, contaminating it and putting its integrity at risk.</p>

<p>These platforms are usually not tested, and so each line added is
potentially harmful for the whole system. Then, each development
on these platforms usually results in collateral problems in the user
experience itself.</p>

<p>As I see it, this is unacceptable in our times.
We propose a platform conceived for developers, thought of and deeply
reflected on. This does not mean that the code is right from the very
start; our declaration of intent is simply to take this project to a certain
point where companies can trust in the project in order to build their
own.</p>

<p>We present you <a href="http://elcodi.io">Elcodi</a>.</p>

<p>We are just beginning to emerge with an approach divided into phases.
Our roadmap is very clear to us, and so in the next few months we
will develop the main features at a core level, as well as the necessary
robustness in order to deal with any outsourcers who like the project in
its initial stage and wish to join us in this journey, aimed at improving
the lifestyle of developers.</p>

<p>The platform is based on Symfony2 and, following the philosophy
defined by its own framework, we have focused most of the
architecture by using a strong layer of events, fully uncoupling most
behaviours and components.</p>

<p>If you are a Symfony programmer, I suggest that you check it out. You
will see errors, a thousand things left to develop and to improve; but,
like with all projects, our greatest ambition is its own construction;
therefore, it’s a matter of months, energy and development.
Another of our objectives is building a good documentation.</p>

<p>Essentially, we have three documentation lines in mind. Firstly, we
want to communicate our philosophy to other people; the direction
the project will undoubtedly take, regardless of its implementation
in a given moment. It is important to define this from the beginning,
because to a great extent it links us to our target audience.
Documentation is a slow process, which is also subject to collaboration,
and at first it will be in English only.</p>

<p>Finally, I should say that elcodi.com is a rapidly expanding company.
We have good growth projections, and so we are certain that what we
are starting today with such enthusiasm will not cease to grow.
We want it to be useful; we want our proposal to be seen by everybody,
to get your most constructive criticism, since only in this way we can
really make an interesting project for us all.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/28/camino-hacia-drupal8/">Camino Hacia Drupal8</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-28T16:27:00+02:00" pubdate data-updated="true">Apr 28<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/04/28/camino-hacia-drupal8/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Debo reconocer que 12 horas de avión son muchas horas. Sobretodo porque, aún
teniendo formas de distraerse ( Asumo de raiz que no se puede dormir&hellip; Podría
enumerar infinidad de razones&hellip; niños gritando, llorando o jugando, asientos
muy pequeños para la gente alta como yo&hellip; ) el reconocido JetLag desgasta toda
la semana posterior al viaje.</p>

<p>El tema es que, a pesar de todo, cuando la razón del viaje no es otra que
conocer compañeros nuevos, conocer una comunidad, una cultura, un país, una
gastronomía, unas costumbres&hellip; cuando la razón es mucho más que un simple
viaje de placer, estas horas pesadas pasan a ser lo de menos.</p>

<p>Hoy he vuelto de México tras una maravillosa semana en el DF, exactamente en el
DrupalCamp México 2014. Mi misión, hablar de Symfony a una comunidad que todavía
no lo tiene claro, viendo como su proyecto evoluciona a otro nivel.</p>

<p>Os pongo en contexto.</p>

<p>Drupal es un proyecto escrito en PHP4. Como wordpress, su core y su filosofía
se basas en un sistema de módulos instalables, reemplazando lo que nosotros
llamamos <em>Event Layer</em> por los ya mas que personalmente olvidados <em>Hooks</em>.
El código está lleno de los llamados Drupalismos, un término creado y designado
a los <em>Coding Standards</em>, tanto en su forma como en su estructura en el cual se
basa todo el proyecto.</p>

<p>Personalmente, muy mejorable.</p>

<p>Quiero aclarar de raiz que todo lo que añado a continuación es una simple
opinión. Mi punto de vista sobre el contexto social que se vive en todo el
continente latinoamericano, y en toda la comunidad Drupal.</p>

<p>Siguiendo con el contexto, la versión estable de drupal actual es la 7. Drupal7
es, ha sido y será la última major release Drupal en lenguaje PHP4,
así que en la nueva versión, Drupal8, algunos módulos de Symfony2 se añadirán
como dependencias. Encontramos algo tan útil como el EventDispatcher ( En
Drupal8 aún coexistirán tanto los Hooks como el EventDispatcher, y en la versión
Drupal9, los hooks se eliminarán de forma completa y permanente ), el Routing,
el HttpFoundation, el HttpKernel, el DependencyInjection&hellip;</p>

<p>Al parecer tal decisión ha dividido la comunidad en dos.</p>

<p>Por un lado tenemos la gente que no quiere pasar a Drupal8, alegando complejidad
demasiado elevada en la transición y un BC completo en ambas versiones. En este
colectivo se ha fundado el proyecto <a href="http://backdropcms.org/">Backdrop</a>, un CMS
evolucionado de Drupal7, con la misma filosofía de arquitectura, y con un cambio
en la forma de trabajar ( Sistema de releases, de features ) y por consiguiente,
con una comunidad estructurada.</p>

<p>Por otro lado tenemos a los que ven a Drupal8 como una posibilidad para
renovarse, para aventurarse en lo desconocido, aprender y resolver aquella deuda
técnica que han generado durante tanto años, apostando tal vez demasiado por la
flexibilidad que propone Drupal desde hace tiempo.</p>

<p>Yo les conocí, a ambos, en el mismo lugar.</p>

<p>En este post quiero defender la evolución de un colectivo, la evolución de
personas que muy honradamente quieren ganarse la vida, y a la par, aprender a
programar utilizando las últimas tendencias en diseño, los patrones más
innovadores, apostando por un modelo sostenible, colaborativo y
completamente escalable.</p>

<p>Yo creo en el crecimiento personal como parte de un crecimiento superior, el de
una comunidad. Les conocí en el Camp y me transmitieron ganas de aprender, ganas
de adquirir conocimientos que, aparentemente, tanto cuesta adquirir. Tengo que
admitir que defender el primer colectivo es una cuestión de mediocridad muy
lícita ( como toda alternativa en el momento que, almenos a uno, le soluciona
un problema ). Defender el mero hecho de no evolucionar, me hace reflexionar
en que tal vez no se den cuenta que solo ellos son capaces de cambiar
el mundo, y estando en sus manos este cambio tan grande, deciden quedarse con lo
que &ldquo;ya funciona&rdquo;. El &ldquo;ya está bien, para que cambiarlo&rdquo; no forma parte de
mi filosofía profesional, y por lo tanto, es imposible que llegue a lidiar
con ella.</p>

<p>Todo gran cambio requiere de un gran sacrificio. Todo gran aprendizaje requiere
un gran cambio, por lo que sacrificarte solo aporta nutrirse de nuevas opciones,
herramientas para el buen escultor, cuya ambición no es otra que tallar la
figura perfecta.</p>

<p>Señores de <em>backdrop</em>, ustedes solo quieren seguir dotando a una comunidad
gigante con un palo de madera para tallar figuras renacentistas. Me parece
ridículo. Me parece prehistórico.</p>

<p>El hombre tuvo que aprender a hacer fuego de una simple rama, y ahora somos una
sociedad avanzada, en gran parte, por que podemos iluminar una habitación oscura
de la forma más primitiva.</p>

<p>Señores de <em>backdrop</em>, ustedes quieren seguir aceptando que PHP4 es válido, y no
lo es. Si fuera por PHP4, si fuera por la negación de la evolución cuando la POO
apareció antaño, hoy en día seríamos incapaces de hablar de Dependency
Injection, de arquitecturas hexagonales y de patrones de diseño avanzados, cuya
función desde el mismo día de su proposición no ha sido otra que hacer
evolucionar al pensador, al escultor, al programador.</p>

<p>Y creo que lo ha conseguido, con creces.</p>

<p>Y es que todo ser humano es simple. Si damos opciones, elige mal. Si proponemos
efectivamente el hecho de seguir siendo mediocre, el ser humano verá en esta
opción su zona de comfort, y no evolucionará.</p>

<p>Por qué no utilizan esta energía para mover masas? Por qué no utilizan esta
fuerza que tan bien utilizan en quejarse, para ser el referente de un pueblo en
su camino hacia un nuevo punto de partida?</p>

<p>Finalmente, un mensaje al desarrollador Drupal indeciso. ¿Por qué teniendo
herramientas para hacer catedrales magníficas, se empeñan en hacer chozas de
madera? ¿Por qué no pasar al siguiente nivel?</p>

<p>Pues exactamente están en esta posición. ¿Acaso se creen que se hallarán solos en
este mar llamado desconocimiento? Tienen la oportunidad de crecer juntos como
comunidad hacia un objetivo común, mejorar, sea como sea. Yo no lo pensaría mas
de dos veces&hellip;</p>

<p>Sean valientes, interés es el pretexto del conocimiento y del éxito, así que les
animo a que den una oportunidad al progreso, a su capacidad, a que
Drupal8 y Symfony sean su tarjeta de embarque para su éxito personal y
profesional, así como un acceso directo a una comunidad proactiva y
colaborativa.</p>

<p>Aquí estaremos los que ya hemos sufrido para que su camino sea un poco más leve.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/17/elcodi/">Elcodi, Una Nueva Aventura en Symfony2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-17T12:46:00+02:00" pubdate data-updated="true">Apr 17<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/04/17/elcodi/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ciertos cambios están por llegar. Y parece ser que son cambios buenos. Llevo
unas cuantas semanas sin escribir en el blog, y la verdad es que me sabe mal.
Me gusta contar cosas que me van sucediendo en la empresa. Problemas que nos
vamos encontrando y soluciones que se me van ocurriendo. El problema es que
llevo unos meses muy centrado en el proyecto que justo hoy lanzamos al mundo.
Es un proyecto inicialmente de desarrolladores para desarrolladores, centrado en
cubrir necesidades reales de los developers destinados a diseñar y
programar ecommerces.</p>

<p>Es cierto que tenemos muchísimas plataformas y opciones para desarrollar
ecommerces alrededor del mundo. Podría enumerar unos cuantos, y probablemente
todos tengan unas métricas y unos KPIs magníficos.</p>

<p>Los problemas de estas plataformas es que son completamente B2B, por lo que tienen sentido cuando
el usuario final simplemente debe tener una buena interfaz de administración,
de instalación y de configuración; y que cuando los departamentos técnicos quieren
desarrollar, tanto horizontalmente ( nuevas funcionalidades de
aquello que ya se está utilizando, o simplemente customizar ) como verticalmente
( nuevas funcionalidades ), estas plataformas B2B se quedan
cortas, por lo que la empresa tiene que desembolsar una cantidad enorme de
dinero en un refáctoring, o simplemente, se debe empezar a todar el código
existente, ensuciándolo y haciendo peligrar su integridad.</p>

<p>Estas plataformas no suelen estar testeadas, por lo que cada línea que se añade
es una línea potencialmente dañina para todo el sistema, con lo que cada
desarrollo sobre estas plataformas suelen derivar en problemas colaterales
en la propia experiencia de usuario.</p>

<p>Desde mi punto de vista, en los tiempos que corren, esto es inaceptable.</p>

<p>Nosotros proponemos una plataforma pensada para los desarrolladores, pensada
y profundamente reflexionada. Esto no implica que el código deba estar bien
en una primera instancia, simplemente nuestra declaración de intenciones es
llevar el proyecto a un punto donde las empresas puedan confiar en el proyecto
para construir el suyo propio.</p>

<p>Os presentamos <a href="http://elcodi.io">Elcodi</a>.</p>

<p>En un planteamiento dividido en fases, justo estamos naciendo. Tenemos muy claro
cual es nuestro roadmap, por lo que en los próximos meses se desarrollaran las
principales features a nivel de core, así como la robustez necesaria como para
poder lidiar con colaboradores externos, que les guste el proyecto en su estado
inicial y que quieran acomparnos en este viaje, destinado a mejorar el estilo de
vida de los developers.</p>

<p>La plataforma está basada en Symfony2, y siguiendo la filosofía definida por el
propio framework, hemos enfocado la mayor parte de la arquitectura utilizando
una fuerte capa de eventos, desacoplando la mayoría de comportamientos y
componentes completamente.</p>

<p>Si eres programador Symfony, te propongo que almenos le eches un vistazo.
Verás errores, mil cosas a desarrollar y mil cosas a mejorar, pero como todo
proyecto, nuestra mayor ambición es la propia construcción del mismo, por lo que
es cuestión de meses, ganas y desarrollo.</p>

<p>Otro de nuestros objetivos es llegar a construir una buena documentación.
Tenemos esencialmente tres líneas de documentación en mente. Por un lado</p>

<p>queremos transmitir a los demás nuestra filosofía. La dirección que, sin duda
alguna, tomará el proyecto, independientemente de la implementación que este
adquiera en un momento dado. Es importante definir esto inicialmente porque al
final nos vincula muchísimo al target al que vamos destinados.</p>

<p>La documentación es algo lento, también sujeta a colaboraciones, y en principio
estará inicialmente solo en inglés.</p>

<p>Finalmente decir que elcodi.com es una empresa en plena expansión. Tenemos
buenas previsiones de crecimiento por lo que tenemos una garantía que lo que hoy
con tanta ilusión estamos empezando, no dejará de crecer.</p>

<p>Queremos que sea útil, queremos que nuestra propuesta esté a juicio de todo el
mundo y que saque vuestras críticas mas constructivas, solo así podremos
realmente hacer un proyecto interesante para todos.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/11/custom-controller-annotations/">Custom Controller Annotations</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-11T20:21:00+01:00" pubdate data-updated="true">Feb 11<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/02/11/custom-controller-annotations/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The goal is easy: To provide a very intuitive and easy way of creating
controller annotations in Symfony2.</p>

<p><a href="https://github.com/mmoreram/ControllerExtraBundle">ControllerExtraBundle</a>
is both a set of annotations and a platform for creating new custom ones.
Actually, the bundle can create a new Entity, like ParamConverter does, with in
this case is just an empty Entity. The bundle also can create FormTypes, Forms
and FormViews with several options. Can also automate the doctrine <code>flush()</code>
action after the method execution or log something before / after every desired
action.</p>

<p>Bundle is still being tested in production environments, all feedback will be
very very useful.</p>

<p>Let&rsquo;s see how can we create our Annotations.</p>

<ul>
<li>Annotation</li>
<li>Resolver</li>
<li>Definition</li>
<li>Registration</li>
</ul>


<h2>Annotation</h2>

<p>The annotation object. You need to define the fields your custom annotation
will contain.
Must extends <code>Mmoreram\ControllerExtraBundle\Annotation\Abstracts\Annotation</code>
abstract class.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">My\Bundle\Annotation</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Mmoreram\ControllerExtraBundle\Annotation\Abstracts\Annotation</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Entity annotation driver</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @Annotation</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">MyCustomAnnotation</span> <span class="k">extends</span> <span class="nx">Annotation</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var string</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Dummy field</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$field</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Get Dummy field</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return string Dummy field</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getField</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Resolver</h2>

<p>Once you have defined your own annotation, you have to resolve how this
annotation works in a controller. You can manage this using a Resolver. Must
extend <code>Mmoreram\ControllerExtraBundle\Resolver\Interfaces\AnnotationResolverInterface;</code>
abstract class.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">My\Bundle\Resolver</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Mmoreram\ControllerExtraBundle\Resolver\Interfaces\AnnotationResolverInterface</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Mmoreram\ControllerExtraBundle\Annotation\Abstracts\Annotation</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * MyCustomAnnotation Resolver</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">MyCustomAnnotationResolver</span> <span class="k">implements</span> <span class="nx">AnnotationResolverInterface</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Specific annotation evaluation.</span>
</span><span class='line'><span class="sd">     * This method MUST be implemented because is defined in the interface</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param Request          $request    Request</span>
</span><span class='line'><span class="sd">     * @param Annotation       $annotation Annotation</span>
</span><span class='line'><span class="sd">     * @param ReflectionMethod $method     Method</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return MyCustomAnnotationResolver self Object</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">evaluateAnnotation</span><span class="p">(</span>
</span><span class='line'>                                        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
</span><span class='line'>                                        <span class="nx">Annotation</span> <span class="nv">$annotation</span><span class="p">,</span>
</span><span class='line'>                                        <span class="nx">ReflectionMethod</span> <span class="nv">$method</span> <span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * You can now manage your annotation.</span>
</span><span class='line'><span class="sd">         * You can acced to its fields using public methods.</span>
</span><span class='line'><span class="sd">         * </span>
</span><span class='line'><span class="sd">         * Annotation fields can be public and can be acceded directly,</span>
</span><span class='line'><span class="sd">         * but is better for testing to use getters; they can be mocked.</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="nv">$field</span> <span class="o">=</span> <span class="nv">$annotation</span><span class="o">-&gt;</span><span class="na">getField</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * You can also access to existing method parameters.</span>
</span><span class='line'><span class="sd">         * </span>
</span><span class='line'><span class="sd">         * Available parameters are:</span>
</span><span class='line'><span class="sd">         * </span>
</span><span class='line'><span class="sd">         * # ParamConverter parameters ( See `resolver_priority` config value )</span>
</span><span class='line'><span class="sd">         * # All method defined parameters, included Request object if is set.</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="nv">$entity</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;entity&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * And you can now place new elements in the controller action.</span>
</span><span class='line'><span class="sd">         * In this example we are creating new method parameter</span>
</span><span class='line'><span class="sd">         * called $myNewField with some value</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
</span><span class='line'>            <span class="s1">&#39;myNewField&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="k">new</span> <span class="nv">$field</span><span class="p">()</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This class will be defined as a service, so this method is computed just
before executing current controller. You can also subscribe to some kernel
events and do whatever you need to do ( You can check
<code>Mmoreram\ControllerExtraBundle\Resolver\LogAnnotationResolver</code> for some
examples.</p>

<h2>Definition</h2>

<p>Once Resolver is done, we need to define our service as an Annotation
Resolver. We will use a custom <code>tag</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># Resolvers</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="l-Scalar-Plain">my.bundle.resolvers.my_custom_annotation_resolver.class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">My\Bundle\Resolver\MyCustomAnnotationResolver</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># Resolvers</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="l-Scalar-Plain">my.bundle.resolvers.my_custom_annotation_resolver</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="err">%</span><span class="l-Scalar-Plain">my.bundle.resolvers.my_custom_annotation_resolver.class%</span>
</span><span class='line'>        <span class="l-Scalar-Plain">tags</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">controller_extra.annotation</span> <span class="p-Indicator">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Registration</h2>

<p>We need to register our annotation inside our application. We can just do it in
the <code>boot()</code> method of <code>bundle.php</code> file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">My\Bundle</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\Bundle\Bundle</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Doctrine\Common\Annotations\AnnotationRegistry</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * MyBundle</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ControllerExtraBundle</span> <span class="k">extends</span> <span class="nx">Bundle</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Boots the Bundle.</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$kernel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;kernel&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">AnnotationRegistry</span><span class="o">::</span><span class="na">registerFile</span><span class="p">(</span><span class="nv">$kernel</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">locateResource</span><span class="p">(</span><span class="s2">&quot;@MyBundle/Annotation/MyCustomAnnotation.php&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Et voilà!</em>  We can now use our custom Annotation in our project controllers.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/03/cache-clear-en-symfony2/">Cache Clear en Symfony2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-03T15:11:00+01:00" pubdate data-updated="true">Jan 3<span>rd</span>, 2014</time>
        
         | <a href="/blog/2014/01/03/cache-clear-en-symfony2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Vacía la caché de Symfony, y la vuelve a crear (sino se especifica lo contrario)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>php app/console cache:clear <span class="o">[</span>--no-warmup<span class="o">]</span> <span class="o">[</span>--no-optional-warmers<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Curioso comando existente en el framework Symfony2 desde sus inicios, y poco
utilizado por los proyectos. En realidad, he visto pocos proyectos que utilizen
este comando en los scripts de deploy, por lo que lo más habitual que veremos es
el clásico</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rm -Rf app/cache/*
</span></code></pre></td></tr></table></div></figure>


<p>Pero es correcta esta práctica? Aunque parezca la forma más ágil de limpiar
cache, tengamos en cuenta que Symfony2 tiene procesos internos que muchos de
nosotros desconocemos por completo. Cuando ejecutamos el comando para vaciar
caché ( con la opción <code>--no-warmup</code> ) no tan solo vaciamos el directorio caché
sino que el framework ejecuta el método <code>clear()</code> de todos los servicios que
implementan la interface
<code>Symfony\Component\HttpKernel\CacheClearer\CacheClearerInterface</code> cuya
definición incorporen el tag <code>kernel.cache_clearer</code>.</p>

<p>En otras palabras.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">my_cache_clearer</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Acme\MainBundle\Cache\MyClearer</span>
</span><span class='line'>        <span class="l-Scalar-Plain">tags</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">kernel.cache_clearer</span> <span class="p-Indicator">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Encontraréis mas información y especificación de estos tags
<a href="http://symfony.com/doc/current/reference/dic_tags.html#kernel-cache-clearer">aqui</a>.</p>

<h2>Reflexión</h2>

<p>En realidad es importante fijarse en la opción <code>--no-warmup</code> ya que es la que
cambia el comportamiento del comando. Cuando trabajamos en entornos de
producción, necesitamos que, en tiempo de deploy, nuestra aplicación tenga el
mínimo tiempo de downtime. Esto se consigue reduciendo al máximo el tiempo en
que una caché está vacía.</p>

<h3>Tabla básica de tiempos</h3>

<blockquote><ul>
<li>[1]   Repository status: S1, Cache status: C1</li>
<li>[1-3] Deploy S1 &ndash;> S2</li>
<li>[3-4] Clear cache C1 from /cache</li>
<li>[4-7] Warm up new cache C2 into /cache_new</li>
<li>[7-8] Swap cache C1 &ndash;> C2. Rename /cache_new to /cache</li>
<li>[8]   Repository status: S2, Cache status: C2</li>
</ul>
</blockquote>

<h3>Problema 1</h3>

<p>Entre los tiempos 3 y 8, tenemos que /cache está vacía. Tenemos que tener en
cuenta que estamos en un entorno de producción, por lo que mientras hacemos el
proceso de deployment, nuestros servidores deben estar sirviendo peticiones en
todo momento.</p>

<p>Dado este caso, cada una de las peticiones se dará cuenta que la caché está
vacía, por lo que intentará volverla a montar desde cero. Deberíamos tener en
cuenta, entonces, que entre los tiempos 3 y 8, nuestro servicio estará caido.</p>

<p>De este análisis sacamos que debemos minimizar al máximo el tiempo pasado entre
el clear de la caché a invalidar y el switch a la nueva, o sea, reducir este
intervalo en el que nuestra caché está vacía.</p>

<p>Hace pocos dias propuse un
<a href="https://github.com/symfony/symfony/pull/9930">PR a FrameworkBundle</a> para
gestionar esto.</p>

<p>Lo único que hace es cambiar el orden entre el warm up de la nueva caché y el
clear de la vieja.</p>

<blockquote><ul>
<li>[1]   Repository status: S1, Cache status: C1</li>
<li>[1-3] Deploy S1 &ndash;> S2</li>
<li>[3-6] Warm up new cache C2 into /cache_new</li>
<li>[6-7] Clear cache C1 from /cache</li>
<li>[7-8] Swap cache C1 &ndash;> C2. Rename /cache_new to /cache</li>
<li>[8]   Repository status: S2, Cache status: C2</li>
</ul>


<p>Downtime 2</p></blockquote>

<p>En este punto podemos ver que la ventana que separa el clear de la caché antigua
y el switch con la nueva solo es de dos unidades de tiempo, entre los tiempos 6
y 8. Ahora se nos plantea otro problema.</p>

<h3>Problema 2</h3>

<p>Hemos minimizado al máximo el tiempo de switch entre las dos caches, pero
seguimos teniendo una ventana de 5 unidades de tiempo entre que el repositorio
está en un estado S2 y la caché en un estado C1.</p>

<blockquote><p>Real downtime 5</p></blockquote>

<p>En realidad, dado este análisis solo podríamos actuar de una sola forma, y es
trabajar con un deployment paralelo ( como hace el warmup del cache:clear ).
Esto significa que nunca deployamos sobre nuestra instalación activa</p>

<blockquote><ul>
<li>[1]   Repository status: S1, Cache status: C1 en /project</li>
<li>[1-8] Deployment Repository + cache:clear en /project_warmup</li>
<li>[8]   Repository status: S2, Cache status: C2 en /project_warmup</li>
<li>[8-9] Swap repository S1 &ndash;> S2. Rename /project to /project_warmup</li>
</ul>


<p>Downtime: 0</p></blockquote>

<h3>Problema 3</h3>

<p>En este caso es probable que nuestro proceso de deploy nos modifique elementos
externos, como puede ser ( y probablemente sea ) <code>mysql</code>. Entonces tendremos una
ventana bastante grande donde el modelo deployado en mysql que haga S2 no se
asemeje al modelo Doctrine de S1.</p>

<blockquote><p>Downtime: X</p></blockquote>

<p>So what? Como lo hacéis vosotros? Ya es por sondear un poco hacia donde tira la
gente&hellip;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/23/factory-pattern-in-symfony2/">Factory Pattern in Symfony2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-23T12:10:00+01:00" pubdate data-updated="true">Dec 23<span>rd</span>, 2013</time>
        
         | <a href="/blog/2013/12/23/factory-pattern-in-symfony2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>The pattern.</h2>

<p>The factory pattern gives responsibility to create some instances of certain
types to a class called factory. All possible classes that can instantiate the
factory should always implement an interface, so we will be able to call certain
methods, whether the class is. Let&rsquo;s see an specific and usable example.</p>

<p>First of all, we have an interface called LoggerInterface. Is just an interface
so just define all methods that implementations must implement.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">My\Bundle\Namespace</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Interface for all loggers</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">interface</span> <span class="nx">LoggerInterface</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Logs message given as parameter</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param string $message Message to log</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return LoggerInterface self Object</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">log</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>On the one hand we have an implementation called FileLogger. This class just
write given messages in a file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;/</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">My\Bundle\Namespace</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">My\Bundle\Namespace\LoggerInterface</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * This class logs into specific file</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">FileLogger</span> <span class="k">implements</span> <span class="nx">LoggerInterface</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>   <span class="sd">/**</span>
</span><span class='line'><span class="sd">    * @var file path</span>
</span><span class='line'><span class="sd">    *</span>
</span><span class='line'><span class="sd">    * File path</span>
</span><span class='line'><span class="sd">    */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$filepath</span> <span class="o">=</span> <span class="s1">&#39;/tmp/myfile.log&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Logs message given as parameter</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param string $message Message to log</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return FileLogger self Object</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">log</span><span class="p">(</span><span class="nv">$message</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file_put_contents</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filepath</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And on the other hand we have a ScreenLogger, that just echoes message as it
comes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;/</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">My\Bundle\Namespace</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">My\Bundle\Namespace\LoggerInterface</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * This class logs into specific file</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ScreenLogger</span> <span class="k">implements</span> <span class="nx">LoggerInterface</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Logs message given as parameter</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param string $message Message to log</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return FileLogger self Object</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">log</span><span class="p">(</span><span class="nv">$message</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">echo</span> <span class="nv">$message</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Given a project we may want to specify using configurarion which Logger we want
to use. Since we want to work with dependency injection component offered by
Symfony2 framework, and any class where we will use our Logger is responsible
for knowing as each instance of our Loggers, we need to create a Factory that
is responsible for taking the setting you have specified, return us an
instance of the class we want.</p>

<p>Given this configuration</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="c1"># /app/config/config.yml</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">logger</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">screen</span>
</span></code></pre></td></tr></table></div></figure>


<p>We define our factory service. As <code>type</code> configuration value is a free text
value, if value do not references any Logger type we will throw an exception.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">My\Bundle\Namespace</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * This class is just a Logger factory</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">LoggerFactory</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Create staticly desired Logger</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param string $type Type of Logger to create</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return LoggerInterface Logger instance</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nv">$type</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$instance</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">switch</span> <span class="p">(</span><span class="nv">$type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">case</span> <span class="s1">&#39;screen&#39;</span><span class="o">:</span>
</span><span class='line'>                <span class="nv">$instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ScreenLogger</span><span class="p">();</span>
</span><span class='line'>                <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">case</span> <span class="s1">&#39;file&#39;</span><span class="o">:</span>
</span><span class='line'>                <span class="nv">$instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileLogger</span><span class="p">();</span>
</span><span class='line'>                <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">default</span><span class="o">:</span>
</span><span class='line'>                <span class="k">throw</span> <span class="k">new</span> <span class="nx">BadLoggerDefinitionException</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$instance</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And Factory dependency injection definition.. As factory must not be instanced
to create a Logger ( <code>get</code> method is static ) we must use <code>factory_class</code> to
define the Factory namespace.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="c1"># /my/bundle/Namespace/Resources/config/services.yml</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">my.logger</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">My\Bundle\Namespace\LoggerInterface</span>
</span><span class='line'>        <span class="l-Scalar-Plain">factory_class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">My\Bundle\Namespace\LoggerFactory</span>
</span><span class='line'>        <span class="l-Scalar-Plain">factory_method</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">get</span>
</span><span class='line'>        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="l-Scalar-Plain">logger_type</span><span class="p-Indicator">:</span> <span class="err">%</span><span class="l-Scalar-Plain">logger.type%</span>
</span><span class='line'>
</span><span class='line'>    <span class="l-Scalar-Plain">my.service</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">My\Bundle\Namespace\MyService</span>
</span><span class='line'>        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="l-Scalar-Plain">my_logger</span><span class="p-Indicator">:</span> <span class="err">@</span><span class="l-Scalar-Plain">my.logger</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Prototyping</h2>

<p>Let&rsquo;s take a look at Symfony2 component
<a href="http://symfony.com/doc/current/components/finder.html">Finder</a> class. We have a
class named Manager that uses this class.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">My\Bundle\Namespace</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Finder\Finder</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * This class is just a manager</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Manager</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Do something</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$finder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Finder</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$finder</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">files</span><span class="p">()</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">in</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Placing this <code>new Finder</code> inside Manager class, we assume that Manager has
responsability to know how <code>Finder</code> must be built. This creates dependency
between both objects, and that&rsquo;s wrong. So the point is that we should inject a
new instance of <code>Finder</code> each time we call doSomething.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">My\Bundle\Namespace</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\Finder\Finder</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * This class is just a manager</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Manager</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var Finder</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Finder</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$finder</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Construct method</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param Finder $finder Finder</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Finder</span> <span class="nv">$finder</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">finder</span> <span class="o">=</span> <span class="nv">$finder</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Do something</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">finder</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">files</span><span class="p">()</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">in</span><span class="p">(</span><span class="nx">__DIR__</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And how do we resolve this problem using Dependency Injection? Is as easy as
creating a new service using Finder as class, with prototype scope.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="c1"># /my/bundle/Namespace/Resources/config/services.yml</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">my.finder</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Symfony\Component\Finder\Finder</span>
</span><span class='line'>        <span class="l-Scalar-Plain">scope</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">prototype</span>
</span><span class='line'>
</span><span class='line'>    <span class="l-Scalar-Plain">my.manager</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">My\Bundle\Namespace\Manager</span>
</span><span class='line'>        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="l-Scalar-Plain">my_finder</span><span class="p-Indicator">:</span> <span class="err">@</span><span class="l-Scalar-Plain">my.finder</span>
</span></code></pre></td></tr></table></div></figure>


<p>If we tale a look at <code>Finder</code> class we shall notice that have a static factory
method inside. If we use Factory pattern using this method, we will instanciate
a new <code>Finder</code> object the first time, but not the others.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/18/symfony-rocks/">Symfony2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-18T19:01:00+01:00" pubdate data-updated="true">Dec 18<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/12/18/symfony-rocks/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>No es de extrañar que alguien llegue a considerarme un pequeño obsesionado de
Symfony. Y dado que toda obsesión es mala, puedo asegurar que lo mío no es
obsesión, sino predilección, estima y adulación. Y es que realmente todo mi
desarrollo profesional en estos momentos gira alrededor de esta tecnología,
siendo más que una tecnología una forma de vida, de pensar y de solucionar
ciertos problemas. Lo curioso es que no tan solo enfocados a entornos web,
sino a entornos puramente tecnologicos.</p>

<p>Asi como muchas tecnologías tan solo requieren de un buen manual estructurado y
simplificado, con esto no basta cuando deseas trabajar en un framework de estas
características. Y es que saber trabajar en equipo de forma ordenada, pautada y
comunicativa es algo demasiado básico como para ser descuidada. Reflexionando,
la comunidad Symfony2 a día de hoy es monstruosa. Y creciendo. Por algo será.</p>

<p>Issues abiertas, comentadas, revisadas y resueltas cada día es lo que
escandaliza positivamente de un framework en el que en cada release se posiciona
como número uno para los proyectos más ambiciosos y escalables. Y cada linea de
código pasa a ser una linea objetivamente esencial y perfecta. Tal vez la
palabra que lo define es Arte.</p>

<p>Y es que el camino de este framework puede estar bastante difuminado en el
horizonte, pero si una cosa está clara es que tenemos Symfony para rato, y eso
me anima a crecer como desarrollador para tener capacidad de comprender poco a
poco cada trozo de código, cada feature y cada implementación.</p>

<p>A nivel de arquitectura la verdad es que tiene su que. Muchísimos patrones son
utilizados en simbiosis con metodologias de toda la vida. Cada componente esta
desacoplado tanto como sea posible de los demás, y está documentado bastante
bien ( la comunidad sigue desarrollando la misma documentación a la par que el
propio código, lo cual aporta crecimiento a la par ). Aprender Symfony2 y saber
utilizarlo más allá que &ldquo;Funcionar, funciona&rdquo; te aporta a medio y largo plazo un
conocimiento muy extenso, no tanto de la estructura de clases y de
funcionalidades del propio framework, sino también una capacidad de análisis y
de respuesta a ciertos problemas, utilizando de forma funcional estos patrones
aprendidos y utilizados de forma recurrente.</p>

<p>Y es que los patrones de arquitectura utilizados en este framework son bastante
esenciales en la mente de cualquier buen programador que se precie. Simplemente
se trata de buscar como los demás han solucionado ciertos problemas específicos,
utilizando términos como CompilerPass, Tags o Dependency Injection.</p>

<p>Para empezar, <a href="http://symfony.com/">Symfony</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/11/flushing-doctrine2-entities/">Flushing Doctrine2 Entities</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-11T10:11:00+02:00" pubdate data-updated="true">Oct 11<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/10/11/flushing-doctrine2-entities/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Given this example</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$spain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Country</span><span class="p">;</span>
</span><span class='line'><span class="nv">$spain</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;spain&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$spain</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$france</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Country</span><span class="p">;</span>
</span><span class='line'><span class="nv">$france</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;france&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$france</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>When we flush without defining any kind of parameter, all entities managed by
EntityManager with changes will be flushed.<br/>
To flush a specific entity managed by EntityManager we can just pass the entity
as a parameter in the flush method</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$spain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Country</span><span class="p">;</span>
</span><span class='line'><span class="nv">$spain</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;spain&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$spain</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$france</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Country</span><span class="p">;</span>
</span><span class='line'><span class="nv">$france</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;france&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$france</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * At this point, I only want to flush $spain</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">(</span><span class="nv">$spain</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>To flush an array of entities managed by EntityManager we can pass the array as
a parameter in the flush method</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$spain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Country</span><span class="p">;</span>
</span><span class='line'><span class="nv">$spain</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;spain&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$spain</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$france</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Country</span><span class="p">;</span>
</span><span class='line'><span class="nv">$france</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;france&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$france</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$germany</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Country</span><span class="p">;</span>
</span><span class='line'><span class="nv">$germany</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;germany&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$germany</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * At this point, I only want to flush $spain</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>    <span class="nv">$spain</span><span class="p">,</span>
</span><span class='line'>    <span class="nv">$france</span><span class="p">,</span>
</span><span class='line'><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, how about flushing an ArrayCollection of entities? Lets take a look at the
UnitOfWork code where contains this logic.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">$entity</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">computeChangeSets</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">is_object</span><span class="p">(</span><span class="nv">$entity</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">computeSingleEntityChangeSet</span><span class="p">(</span><span class="nv">$entity</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$entity</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$entity</span> <span class="k">as</span> <span class="nv">$object</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">computeSingleEntityChangeSet</span><span class="p">(</span><span class="nv">$object</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Considering that ArrayCollection is an object, this code should be changed to
this code to also accept ArrayCollection and all iterable objects.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">$entity</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">computeChangeSets</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$entity</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$entity</span> <span class="nx">instanceof</span> <span class="nx">IteratorAggregate</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$entity</span> <span class="k">as</span> <span class="nv">$object</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">computeSingleEntityChangeSet</span><span class="p">(</span><span class="nv">$object</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">is_object</span><span class="p">(</span><span class="nv">$entity</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">computeSingleEntityChangeSet</span><span class="p">(</span><span class="nv">$entity</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/09/inverse-associations-in-doctrine2-models/">Inverse Associations in Doctrine2 Models</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-09T11:37:00+02:00" pubdate data-updated="true">Oct 9<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/10/09/inverse-associations-in-doctrine2-models/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Lets take a look some basic example about simple Doctrine2 relation.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Country</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @ORM\Entity</span>
</span><span class='line'><span class="sd"> * @ORM\Table(name=&quot;countries&quot;)</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Country</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var ArrayCollection</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @ORM\OneToMany(targetEntity=&quot;Province&quot;, mappedBy=&quot;country&quot;)</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$provinces</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Constructor</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">provinces</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayCollection</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Add province</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param Province $province Province to add</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return Country self Object</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">addProvince</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">provinces</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$province</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Province</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @ORM\Entity</span>
</span><span class='line'><span class="sd"> * @ORM\Table(name=&quot;provinces&quot;)</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Province</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var Country</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @ORM\ManyToOne(targetEntity=&quot;Country&quot;, inversedBy=&quot;provinces&quot;)</span>
</span><span class='line'><span class="sd">     * @ORM\JoinColumn(name=&quot;country_id&quot;, referencedColumnName=&quot;id&quot;, nullable=false)</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$country</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Set Country</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param Country $country Country</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return Province self Object</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setCountry</span><span class="p">(</span><span class="nx">Country</span> <span class="nv">$country</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">country</span> <span class="o">=</span> <span class="nv">$country</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Get the country</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return Country</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCountry</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">country</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The reason for this post is to try to understand the direct impact of making an
inversed relationship when we allocate a new province in a country.
Given the model we have in the first instance, and given this piece of
controller</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$country</span> <span class="o">=</span> <span class="nv">$this</span>
</span><span class='line'>    <span class="o">-&gt;</span><span class="na">entityManager</span>
</span><span class='line'>    <span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">&#39;AcmeCoreBundle:Country&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="o">-&gt;</span><span class="na">findBy</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$province</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Province</span><span class="p">();</span>
</span><span class='line'><span class="nv">$province</span><span class="o">-&gt;</span><span class="na">setCountry</span><span class="p">(</span><span class="nv">$country</span><span class="p">);</span>
</span><span class='line'><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$province</span><span class="p">);</span>
</span><span class='line'><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">entityManager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this case, when we assign the Country to the new Province, and given that the
owning side of the association is Province, when you flush, the association
persists in database, so that in future reference, we would have the desired
results.<br/>
The &ldquo;problem&rdquo; exists because our <code>EntityManager</code> works with internal cache.
If after this assignment, and in the same request, we need to return all the
provinces of the Country, in particular the Country with id 1, the returned
collection will not contain the new Province if this data is already cached.
This is because we have not perfomed reversed assignment. There are two ways of
solving this.</p>

<h3>Model owns the responsability of double assignment</h3>

<p>We can resolve this giving model the responsability of double assignment.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Province</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @ORM\Entity</span>
</span><span class='line'><span class="sd"> * @ORM\Table(name=&quot;provinces&quot;)</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Province</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var Country</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @ORM\ManyToOne(targetEntity=&quot;Country&quot;, inversedBy=&quot;provinces&quot;)</span>
</span><span class='line'><span class="sd">     * @ORM\JoinColumn(name=&quot;country_id&quot;, referencedColumnName=&quot;id&quot;, nullable=false)</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$country</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Set Country</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param Country $country Country</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return Province self Object</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setCountry</span><span class="p">(</span><span class="nx">Country</span> <span class="nv">$country</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">country</span> <span class="o">=</span> <span class="nv">$country</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * We perform inversed assignment</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="nv">$country</span><span class="o">-&gt;</span><span class="na">setProvince</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Get the country</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return Country</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCountry</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">country</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This has a good side and bad. On the one hand, is a completely transparent
process so that the model handles internally to manage their relationships.
It allows the driver to disengage completely from the model.
On the other hand, we must bear in mind that <strong>will</strong> always done this inverse
relationship. This can be a plus for a project, unless handled very large
amounts of data.<br/>
To give an example, we can imagine a Country with a million provinces.
When charging Country in memory, while not run the <code>getProvinces ()</code> and since
we work with lazy loading, we will have no memory problem. The problem comes
when you add a new province to Country. As a collection, to add an item,
doctrine do something like <code>getProvinces()</code> and then make
`$provinces[] = $province;&lsquo;.  Keep in mind that loading in memory up to 1
million entities without any need is a non desired behaviour.</p>

<h3>Controller ( each one ) owns the responsability of double assignment</h3>

<p>In this case, controller need to perform inversed assignment.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$country</span> <span class="o">=</span> <span class="nv">$this</span>
</span><span class='line'>    <span class="o">-&gt;</span><span class="na">entityManager</span>
</span><span class='line'>    <span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">&#39;AcmeCoreBundle:Country&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="o">-&gt;</span><span class="na">findBy</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$province</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Province</span><span class="p">();</span>
</span><span class='line'><span class="nv">$province</span><span class="o">-&gt;</span><span class="na">setCountry</span><span class="p">(</span><span class="nv">$country</span><span class="p">);</span>
</span><span class='line'><span class="nv">$country</span><span class="o">-&gt;</span><span class="na">addProvince</span><span class="p">(</span><span class="nv">$province</span><span class="p">);</span>
</span><span class='line'><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$province</span><span class="p">);</span>
</span><span class='line'><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">entityManager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>You will choose if is the best option, so you have an idea about if all
provinces are used later. If are used and a million Provinces are loaded,
you will have the same problem as first case, but has nothing to do about
this&hellip;</p>

<p>My conclusion would be something like &hellip; Know your model and scope, and give
responsibilities accordingly.</p>

<p>What do you think?</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/5/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/3/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/14/symfony-ug-be-our-friend/">Symfony UG, be our friend</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/07/symfony-barcelona-event-september-2015/">Symfony Barcelona Event, September 2015</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/28/eventlisteners-as-collectors-in-symfony/">EventListeners as collectors in Symfony</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/23/symfony-in-barcelona/">Symfony in Barcelona</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/20/re-thinking-event-listeners/">Re-thinking Event Listeners</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/mmoreram">@mmoreram</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mmoreram',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

      </div>
    </div>
    <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Marc Morera -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>. Design by <a href="http://octopressthemes.com">Octopress Themes</a>.</span>
</p>

</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'mmoreram';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </div>
</body>
</html>
