
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Because yes</title>
  <meta name="author" content="Marc Morera">

  
  <meta name="description" content="Las modas y sus modelos me tienen frito. Empiezo así mi post porque no sabría como empezarlo sin ser más directo.
Me tienen frito. Parece que, a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mmoreram.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Because yes" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=Raleway:100" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic|Istok+Web:400,400italic,700,700italic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-41917921-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
  <div id="header-container">
    <div id="header">
      <div class="wrapper">
        <header role="banner"><hgroup>
  <h1><a href="/">Because yes</a></h1>
</hgroup>

</header>
        <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mmoreram.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
      </div>
    </div>
  </div>
  <div id="body"   >
    <div id="main">
      <div id="content">
	<div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/22/las-modas-y-los-modelos-me-tienen-fritos/">Las Modas Y Sus Modelos Me Tienen Frito</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-22T12:27:00+02:00" pubdate data-updated="true">May 22<span>nd</span>, 2014</time>
        
         | <a href="/blog/2014/05/22/las-modas-y-los-modelos-me-tienen-fritos/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Las modas y sus modelos me tienen frito.</p>

<p>Empiezo así mi post porque no sabría como empezarlo sin ser más directo.
Me tienen frito.</p>

<p>Parece que, a pesar de intentar sacar el pecho cuando alguien se mete con
nuestro trabajo, no tenemos personalidad alguna. Parece que nuestra voz no es
otra cosa que un pequeño altavoz, muchas veces rallado y penetrante, cuyo único
objetivo a lo largo del día es, o bien repetir lo que dicen algunas
personalidades, o tratar de imbéciles a los que no piensan igual. Nada más.</p>

<p>Yo soy un gran fan del clean code. No, no me he leido el libro ( Creo que me
repito, pero por si acaso ) y no por esto no puedo corroborar que me ayuda
trabajar de esta forma, y podría llegar a demostrar la cantidad de horas que
me he ahorrado escribiendo mi código bien a la primera.</p>

<p>Ahora bien, tenemos claro que muchas cosas de las que hacemos, las hacemos por
algo? O justamente las hacemos porque lo ha dicho el CTO de no se donde? Es
decir, tenemos control real sobre nuestra infrastuctura, habiendo diseñado
nuestro código conforme a nuestras necesidades reales? O simplemente hemos hecho
el estúpido y vago ejercicio de leernos cuatro libros, visto cuatro charlas y
aceptar que en sus frases no hay nada más que la verdad, copiando sobre el papel
cada idea transmitida por el escritor u orador?</p>

<p>Esto lo suelo pensar mucho, y más ahora que dedico mi tiempo laboral a un
proyecto opensource. Mis movimientos, mis decisiones, afectan no tan solo a mi
proyecto, sino a miles de ellos (Almenos, espero, en un futuro no muy lejano).
Tengo las mismas necesidades que cualquier otro programador a cargo de otro tipo
de proyecto?</p>

<p>Pues yo creo que no.</p>

<p>En nuestro proyecto vamos a tomar decisiones sin basarnos en las modas baratas
(Que no inútiles) que salen continuamente. Baratas porque cuestan muy pocos
comentarios hacerlas pasar de un valor popular incalculable a tener una pésima
valoración, siendo estos comentarios frecuentemente ajenos a nuestros intereses.</p>

<p>Hay que pensar las cosas, discutirlas y identificar sus porqués Pero no os
equivoquéis. El porqué de las cosas es algo relativo, no absoluto. El por qué
tengo que implementar ciertos patrones en mi proyecto, no puedo ni apenas
discutirlo con una persona que desconoce completamente tu modelo de negocio,
tus necesidades comerciales, tus direcciones técnicas. Estas decisiones solo las
puedes tomar tu y tu equipo.</p>

<p>Eso significa que tenemos que dejar de escuchar? Para nada. En escuchar, hablar,
compartir y enseñar está el verdadero valor del progreso y de nuestro trabajo,
pero no podemos quedarnos en este punto, no podemos aceptar que todo lo que dice
una persona con más de medio millón de followers en el twitter es algo que,
seguro, funcionará en mi proyecto.</p>

<p>Hay que pensar las cosas. Y cuando piensas, aprendes. Y aprendiendo, progresas.
Y un día te encuentras que tienes todas las herramientas para poder decidir con
mucha más precisión&hellip; Tanta precisión que resulta que la gente empieza a
escucharte&hellip; Y un día te levantas de la cama y ya tienes medio millón de
followers en el Twitter, y te das cuenta que todo lo que dices, sirve de
referencia para muchísima gente, y en consecuencia para las direcciones técnicas
de muchos proyectos.</p>

<p>Y te acuerdas de todo esto, y en lugar de decir &ldquo;Esto hay que hacerlo así, o lo
estás haciendo mal&rdquo;, acabas transformando tu discurso en &ldquo;Si tenéis este
problema, podéis solucionarlo así. A mí me ha funcionado, espero que a vosotros
también&rdquo;.</p>

<p>De momento, y mientras esto no sea así, las modas y sus modelos me tienen frito.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/20/about-rules-and-expression-language/">Sobre Reglas Y ExpressionLanguage</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-20T14:00:00+02:00" pubdate data-updated="true">May 20<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/05/20/about-rules-and-expression-language/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>You can read an english translation in
<a href="http://blog.elcodi.io/blog/2014/05/20/about-rules-and-expressionlanguage/">Elcodi blog</a></p></blockquote>

<p>Esta implementación trabaja con el ExpressionLanguage de Symfony.</p>

<p>Para instalarlo o entender como funciona, así como para descubrir la syntaxis de
las Expressions puedes utilizar la
<a href="http://symfony.com/doc/current/components/expression_language/index.html">Documentación oficial del Componente</a></p>

<h3>Nuestras necesidades</h3>

<p>En realidad podríamos decir que estamos ante uno de los mayores problemas que ha
sufrido cualquier programador que se haya dedicado mínimamente al ecommerce:
Las reglas de acción. El ejemplo más significativo son los cupones. Cuándo un
cupón es válido? Y dado que hay una cantidad bestial de distintos cupones y
distintas lógicas de aplicación, y dado que estas son distintas y própias de
cada uno de los proyectos&hellip; como se puede abstraer la lógica para que se pueda
hacer algo &ldquo;neutral&rdquo; y lo suficientemente flexible para que todo el mundo lo
pueda utilizar?</p>

<p>Pues esta es una de nuestras preocupaciones principales, ya que la solución a
esta pregunta, de rebote, nos soluciones otros problema paralelos, como por
ejemplo cuando se aplican ciertas acciones, o hasta generar un eventDispatcher
muy flexible, que active cierto evento en cierto punto de la request, si aplica
un conjunto de condiciones.</p>

<h3>Nuestro propósito</h3>

<p><a href="https://github.com/elcodi/RuleBundle">Elcodi RuleBundle</a></p>

<p>Nuestra propuesta no es demasiado compleja.</p>

<p>Partimos de un modelo completamente desacoplado y standalone. El motor de reglas
proporciona una gestión de las mismas independientemente de donde se quieran
utilizar, ya que la única misión para este módulo es devolver <code>true</code> o <code>false</code>.</p>

<p>En este caso hemos tratado con dos tipos de reglas, las Rules y las RuleGroups.
El sentido de la primera es simple, una regla simple que, evaluada, devuelve un
booleano. El sentido de la segunda es en cambio, agrupar Rules, de tal forma
que si decidimos aplicar un conjunto de reglas unidas, podamos trabajar con el
conjunto directamente, y asociarlo a un comportamiento.</p>

<p>Dado este modelo, es bastante evidente que requiere de un Composite Pattern para
que sea más fácil trabajar, ya que este nos proporciona una sola entidad,
independientemente que sea Rule o RuleGroup, y le da un comportamiento común a
ambos, que es al fín y al cabo, el mas importante: Evalúate.</p>

<h3>Utilizando composite pattern con Doctrine</h3>

<p>La primera pregunta que nos viene a la cabeza es&hellip; De que se trata el Composite
Pattern?</p>

<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/5/5a/Composite_UML_class_diagram_%28fixed%29.svg/900px-Composite_UML_class_diagram_%28fixed%29.svg.png" title="composite pattern" alt="Composite pattern" /></p>

<p>En este caso tenemos que tanto Leaf como Composite son dos entidades distintas.
Leaf sería nuestro Rule y Composite sería nuestro RuleGroup. Podemos ver que,
como ambos extienden de un objeto abstracto llamado Component, se puede forzar
que ambos tengan un comportamiento común. En esta gráfica, el abstracto define
un método y lo implementa, dando un comportamiento por defecto y dando la
oportunidad de sobreescribir este comportamiento. En nuestro caso, <code>operation()</code>
responde a la necesidad de devolver todas las expressions del objeto (En el
caso de Rule, una sola expression, en el caso de RuleGroup, todas las
expressions de sus hijos), por lo que se ha definido el método como abstracto,
así cada entidad debe implementar el método a su modo.</p>

<p>Finalmente, y lo que define realmente a este patrón, es que Composite
(RuleGroup) tiene un conjunto de hijos (en nuestro caso Rules) que tanto
pueden ser del tipo Rule o del tipo RuleGroup, por lo que la relación se hace
directamente con el Abstracto.</p>

<p>Esta implementación permite que, cuando se pide las Expression de un RuleGroup,
esta te devuelva la de todos sus hijos, sean Rule o RuleGroup, ya que ambos
elementos implementan el mismo método.</p>

<p>Doctrine te permite hacer esta implementación utilizando el STI (Single Table
Inheritance) o el CTI (Class Table Inheritance). En este caso, y para
ahorrarnos demasiadas joins, hemos tratado la implementación con STI.</p>

<p>Definimos la entidad Rule</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * This file is part of the Elcodi package.</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">Elcodi\RuleBundle\Entity</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Class Rule</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Rule</span> <span class="k">extends</span> <span class="nx">AbstractRule</span> <span class="k">implements</span> <span class="nx">RuleInterface</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var ExpressionInterface</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Expression</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$expression</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Specific class parameters, getters and setters</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Return all object contained expressions</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return ArrayCollection Collection of expressions</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getExpressionCollection</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nx">ArrayCollection</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getExpression</span><span class="p">()));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Definimos la entidad RuleGroup</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * This file is part of the Elcodi package.</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">Elcodi\RuleBundle\Entity</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Class RuleGroup</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">RuleGroup</span> <span class="k">extends</span> <span class="nx">AbstractRule</span> <span class="k">implements</span> <span class="nx">RuleGroupInterface</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var Collection</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Rules</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$rules</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Specific class parameters, getters and setters</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Return all object contained expressions</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return ArrayCollection Collection of expressions</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getExpressionCollection</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$expressions</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * @var AbstractRuleInterface $rule</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getRules</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$rule</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="nv">$expressions</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span>
</span><span class='line'>                <span class="nv">$expressions</span><span class="p">,</span>
</span><span class='line'>                <span class="nv">$rule</span><span class="o">-&gt;</span><span class="na">getExpressionCollection</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">()</span>
</span><span class='line'>            <span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nx">ArrayCollection</span><span class="p">(</span><span class="nv">$expressions</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y finalmente la clase abstracta</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * This file is part of the Elcodi package.</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">Elcodi\RuleBundle\Entity\Abstracts</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Class AbstractRule</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">abstract</span> <span class="k">class</span> <span class="nc">AbstractRule</span> <span class="k">extends</span> <span class="nx">AbstractEntity</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Specific class parameters, getters and setters</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Return all object contained expressions</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return Collection Collection of expressions</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getExpressionCollection</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ambas clases implementan a su modo el método <code>getExpressionCollection()</code> por lo
que cuando se trate con un ArrayCollection devuelto por Doctrine, todas las
instancias tendrán el método.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd">* @var Collection $rules</span>
</span><span class='line'><span class="sd">*/</span>
</span><span class='line'><span class="k">foreach</span> <span class="p">(</span><span class="nv">$rules</span> <span class="k">as</span> <span class="nv">$rule</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>   <span class="sd">/**</span>
</span><span class='line'><span class="sd">    * @var AbstractRule $rule</span>
</span><span class='line'><span class="sd">    */</span>
</span><span class='line'>   <span class="nv">$expressionCollection</span> <span class="o">=</span> <span class="nv">$rule</span><span class="o">-&gt;</span><span class="na">getExpressionCollection</span><span class="p">();</span>
</span><span class='line'>   <span class="o">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Una vez tenemos las clases, debemos mapearlas a Doctrine.</p>

<p>Mapeamos la clase Rule, con una relación unidireccional con Expression</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">Elcodi\RuleBundle\Entity\Rule</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">entity</span>
</span><span class='line'>    <span class="l-Scalar-Plain">repositoryClass</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\RuleBundle\Repository\RuleRepository</span>
</span><span class='line'>    <span class="l-Scalar-Plain">table</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rule</span>
</span><span class='line'>
</span><span class='line'>    <span class="l-Scalar-Plain">oneToOne</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">expression</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="l-Scalar-Plain">targetEntity</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\RuleBundle\Entity\Expression</span>
</span><span class='line'>            <span class="l-Scalar-Plain">cascade</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span> <span class="nv">all</span> <span class="p-Indicator">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Mapeamos la clase RuleGroup, con una relación ManyToMany unidireccional (No nos
interesa saber <code>parents()</code>) con AbstractRule</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">Elcodi\RuleBundle\Entity\RuleGroup</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">entity</span>
</span><span class='line'>    <span class="l-Scalar-Plain">repositoryClass</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\RuleBundle\Repository\RuleGroupRepository</span>
</span><span class='line'>    <span class="l-Scalar-Plain">table</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rule_group</span>
</span><span class='line'>
</span><span class='line'>    <span class="l-Scalar-Plain">manyToMany</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">rules</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="l-Scalar-Plain">targetEntity</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\RuleBundle\Entity\Abstracts\AbstractRule</span>
</span><span class='line'>            <span class="l-Scalar-Plain">joinTable</span><span class="p-Indicator">:</span>
</span><span class='line'>                <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rule_group_rule</span>
</span><span class='line'>                <span class="l-Scalar-Plain">joinColumns</span><span class="p-Indicator">:</span>
</span><span class='line'>                    <span class="l-Scalar-Plain">rule_group_id</span><span class="p-Indicator">:</span>
</span><span class='line'>                        <span class="l-Scalar-Plain">referencedColumnName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
</span><span class='line'>                <span class="l-Scalar-Plain">inverseJoinColumns</span><span class="p-Indicator">:</span>
</span><span class='line'>                    <span class="l-Scalar-Plain">rule_id</span><span class="p-Indicator">:</span>
</span><span class='line'>                        <span class="l-Scalar-Plain">referencedColumnName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">id</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y finalmente generamos el mapeo de la clase abstracta</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">Elcodi\RuleBundle\Entity\Abstracts\AbstractRule</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">entity</span>
</span><span class='line'>    <span class="l-Scalar-Plain">repositoryClass</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\RuleBundle\Repository\AbstractRuleRepository</span>
</span><span class='line'>    <span class="l-Scalar-Plain">inheritanceType</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">single_table</span>
</span><span class='line'>    <span class="l-Scalar-Plain">discriminatorColumn</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">discr</span>
</span><span class='line'>        <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
</span><span class='line'>    <span class="l-Scalar-Plain">discriminatorMap</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">rule</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\RuleBundle\Entity\Rule</span>
</span><span class='line'>        <span class="l-Scalar-Plain">rule_group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\RuleBundle\Entity\RuleGroup</span>
</span><span class='line'>    <span class="l-Scalar-Plain">fields</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Esta configuración creará una sola tabla, con un campo dedicado a decirle a
Doctrine de que tipo es la fila en cuestión.</p>

<p>Llegados a este punto, tenemos una implementación para poder asignar a cualquier
entidad una relación con Rules, teniendo solucionado, almenos a nivel de dominio
y de implementación el concepto &ldquo;Regla de Reglas&rdquo;, pero ahora falta solucionar
el cómo se ejecutan estas reglas y el contexto en el que lo hacen.</p>

<h3>Configuración de contexto y customización</h3>

<p>Definamos contexto en el que una regla se ejecuta como el conjunto de elementos
en el que la regla tiene acceso en el momento de la ejecución.</p>

<p>Ya que el motor trabaja utilizando el ExpressionLanguage de Symfony, hemos
utilizado su forma de contextualizar una evaluación.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$language</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ExpressionLanguage</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Apple</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="nv">$variety</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$apple</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Apple</span><span class="p">();</span>
</span><span class='line'><span class="nv">$apple</span><span class="o">-&gt;</span><span class="na">variety</span> <span class="o">=</span> <span class="s1">&#39;Honeycrisp&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$language</span><span class="o">-&gt;</span><span class="na">evaluate</span><span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;fruit.variety === &quot;Honeycrisp&quot;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;fruit&#39;</span> <span class="o">=&gt;</span> <span class="nv">$apple</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>En este caso, ejecutamos la expresión &ldquo;fruit.variety&rdquo; en un contexto donde
<code>fruit</code> es nuestra instancia de <code>Apple</code>, por lo que este assert resolvería como
<code>true</code>.</p>

<p>En el caso siguiente, y teniendo la misma expresión, al tener una
contextualización distinta, no tendríamos el resultado esperado, pues devolvería
<code>false</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$language</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ExpressionLanguage</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Apple</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="nv">$variety</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$apple</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Apple</span><span class="p">();</span>
</span><span class='line'><span class="nv">$apple</span><span class="o">-&gt;</span><span class="na">variety</span> <span class="o">=</span> <span class="s1">&#39;Arlet&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$language</span><span class="o">-&gt;</span><span class="na">evaluate</span><span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;fruit.variety === &quot;Honeycrisp&quot;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;fruit&#39;</span> <span class="o">=&gt;</span> <span class="nv">$apple</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>Hay dos tipos de contextualizaciones, las que responden a una request (En toda
las evaluaciones dada una request se setean unos valores globales,
independientemente de la ejecución) y las que responden a cada llamada del
manager.</p>

<p>En este caso se trata de una contextualización de llamada, pues en esta
evaluación, <code>customer</code> responde a $myCustomer.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Rule with code &quot;somecode&quot; has this expression assigned: </span>
</span><span class='line'><span class="sd"> * &quot;customer.id in [1..100]&quot;</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$myCustomer</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>
</span><span class='line'><span class="nv">$ruleManager</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;rule_manager&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$ruleManager</span><span class="o">-&gt;</span><span class="na">evaluateByCode</span><span class="p">(</span><span class="s1">&#39;somecode&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;customer&#39;</span>  <span class="o">=&gt;</span>  <span class="nv">$myCustomer</span>
</span><span class='line'><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>Es posible pero que tengamos servicios, por ejemplo, a los que queramos acceder
de forma reiterada, y que haya una forma independiente de acceder a ellos, por
ejemplo, el <code>entity_manager</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Rule with code &quot;somecode&quot; has this expression assigned: </span>
</span><span class='line'><span class="sd"> * &quot;customer_wrapper.getCustomer().getId() in [1..100]&quot;</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$ruleManager</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;rule_manager&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$ruleManager</span><span class="o">-&gt;</span><span class="na">evaluateByCode</span><span class="p">(</span><span class="s1">&#39;somecode&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>customer_wrapper</code> en realidad es un servicio que, a su forma, nos instancia un
Customer recuperable mediante el método <code>getCustomer</code>. No debemos pasarlo cada
vez que queremos evaluar una Expresión, así que podemos considerarla como parte
del contexto global.</p>

<p>Como podemos añadir valores a este contexto global? Pues implementando un
<code>ContextConfigurationInterface</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * This file is part of the Elcodi package.</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">Elcodi\RuleBundle\Configuration</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Doctrine\Common\Persistence\ObjectManager</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Elcodi\RuleBundle\Configuration\Interfaces\ContextConfigurationInterface</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Elcodi\RuleBundle\Services\Interfaces\ContextAwareInterface</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Class ContextConfiguration</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ContextConfiguration</span> <span class="k">implements</span> <span class="nx">ContextConfigurationInterface</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var ObjectManager</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Object manager</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$objectManager</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Construct method</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param ObjectManager $objectManager Object manager</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">ObjectManager</span> <span class="nv">$objectManager</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">objectManager</span> <span class="o">=</span> <span class="nv">$objectManager</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @param ContextAwareInterface $contextAware</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">configureContext</span><span class="p">(</span><span class="nx">ContextAwareInterface</span> <span class="nv">$contextAware</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$contextAware</span><span class="o">-&gt;</span><span class="na">addContextElement</span><span class="p">(</span><span class="s1">&#39;manager&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">objectManager</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Podemos observar que en este caso estamos contextualizando todo el gestor de
expresiones con el <code>EntityManager</code> respondiendo al valor <code>manager</code>, así que
si en una Expression tenemos a expresión <code>manager.getRepository("...")</code> podremos
acceder perfectamente al EntityManager.</p>

<p>Finalmente, y para terminar de añadir este valor al contexto, debemos definir
esta clase como servicio utilizando un tag específico.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">elcodi.core.rule.configuration.context</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="err">%</span><span class="l-Scalar-Plain">elcodi.core.rule.configuration.context.class%</span>
</span><span class='line'>        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="l-Scalar-Plain">entity_manager</span><span class="p-Indicator">:</span> <span class="err">@</span><span class="l-Scalar-Plain">doctrine.orm.entity_manager</span>
</span><span class='line'>        <span class="l-Scalar-Plain">tags</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">elcodi.rule_context_configuration</span> <span class="p-Indicator">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Configuración de ExpressionLanguage y customización</h3>

<p>Otra de las facilidades que nos brinda el ExpressionLanguage es la capacidad de
crear funciones. En este caso podemos agregar nuevas funcionalidades al
ExpressionLanguage del sistema de Reglas implementando
<code>ExpressionLanguageConfigurationInterface</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * This file is part of the Elcodi package.</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">Elcodi\RuleBundle\Configuration</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\ContainerInterface</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Elcodi\RuleBundle\Configuration\Interfaces\ExpressionLanguageConfigurationInterface</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Elcodi\RuleBundle\Services\Interfaces\ExpressionLanguageAwareInterface</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Class ExpressionLanguageConfiguration</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ExpressionLanguageConfiguration</span> <span class="k">implements</span> <span class="nx">ExpressionLanguageConfigurationInterface</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var ContainerInterface</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Container</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$container</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Construct method</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param ContainerInterface $container Container</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">ContainerInterface</span> <span class="nv">$container</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span> <span class="o">=</span> <span class="nv">$container</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Configures expression language</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param ExpressionLanguageAwareInterface $expressionLanguageAware Expression Language aware</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">configureExpressionLanguage</span><span class="p">(</span><span class="nx">ExpressionLanguageAwareInterface</span> <span class="nv">$expressionLanguageAware</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$expressionLanguage</span> <span class="o">=</span> <span class="nv">$expressionLanguageAware</span><span class="o">-&gt;</span><span class="na">getExpressionLanguage</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$expressionLanguage</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="s1">&#39;service&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;$this-&gt;get(%s)&#39;</span><span class="p">,</span> <span class="nv">$arg</span><span class="p">);</span>
</span><span class='line'>            <span class="p">},</span> <span class="k">function</span> <span class="p">(</span><span class="k">array</span> <span class="nv">$variables</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$expressionLanguage</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="s1">&#39;parameter&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;$this-&gt;getParameter(%s)&#39;</span><span class="p">,</span> <span class="nv">$arg</span><span class="p">);</span>
</span><span class='line'>            <span class="p">},</span> <span class="k">function</span> <span class="p">(</span><span class="k">array</span> <span class="nv">$variables</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Vemos que hemos añadido el mismo comportamiento que tiene el ExpressionLanguage
cuando se utiliza en las definiciones del DependencyInjection. Se agregan dos
funciones nuevas y ambas requieren del container entero, por lo que se tiene que
definir esta clase como servicio, añadiendo de nuevo un tag específico.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">elcodi.core.rule.configuration.expression_language</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="err">%</span><span class="l-Scalar-Plain">elcodi.core.rule.configuration.expression_language.class%</span>
</span><span class='line'>        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="l-Scalar-Plain">service_container</span><span class="p-Indicator">:</span> <span class="err">@</span><span class="l-Scalar-Plain">service_container</span>
</span><span class='line'>        <span class="l-Scalar-Plain">tags</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">elcodi.rule_expression_language_configuration</span> <span class="p-Indicator">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>De esta forma, podríamos ejecutar esta expresión
<code>service("my_service")-&gt;getValue(parameter("my_value"))</code> sin tener una Exception
del tipo SyntaxException.</p>

<p>El RuleManager controla cuando una expresión tiene una exceptión del tipo
SyntaxException ya que tiene todo el contenido de evaluación dentro de un
try/catch. El sentido de esto es que en caso que una expresión tenga un error
porque, o bien el modelo ha cambiado o la propia implementación, debería seguir
funcionando, evidentemente devolviendo <code>false</code> como resultado.</p>

<h3>Cupones y Reglas</h3>

<p>Dado que aún no tenemos implementado las reglas en los cupones, vamos a enumerar
a nivel teórico como debería ser el comportamiento de este caso a nivel de
ejemplificación.</p>

<h4>Prerequisitos</h4>

<ul>
<li>Tenemos una relación entre Coupon y AbstractRule de ManyToMany (Un Coupon puede
tener tantos cupones como quiera, y una Regla puede estar en mas de un Cupón)</li>
<li>El usuario, a partir del código de un cupón, intenta aplicar un descuento a su
carrito. El cupón en cuestión tiene asignadas 3 Rules.</li>
</ul>


<h4>Paso a paso</h4>

<ul>
<li>El usuario aplica el cupón</li>
<li>Mediante el couponManager, se intenta aplicar el cupón al cart.</li>
<li>Se dispara un evento PreApplyToCart</li>
<li>Hay un eventListener suscrito a este evento que busca todas las Rules del cart
y las evalúa</li>
<li>Si una de ellas devuelve <code>false</code>, la evaluación conjunta devolverá <code>false</code>, por lo
que se devolverá una Exception específica</li>
<li>Por contra, si devuelve <code>true</code>, seguirá con el proceso natural (Se aplicará el
cupón)</li>
</ul>


<h3>Conclusiones</h3>

<p><code>RuleBundle</code> es una herramienta muy potente, no solo para trabajar con Reglas de
cupones sino también para poder gestionar otras necesidades como Campañas de
descuento, Grupos de usuarios, reglas de cart y reglas de producto.</p>

<p>Como siempre, esta es una aproximación a la solución, pues estamos abiertos a
debate, mejoras y <a href="https://github.com/elcodi/elcodi/tree/master/src/Elcodi/RuleBundle">contribuciones</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/19/restrospectiva/">Restrospectiva De Un Ponente</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-19T13:27:00+02:00" pubdate data-updated="true">May 19<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/05/19/restrospectiva/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Este fin de semana ha sido la DrupalCamp de Valencia. Tuve la suerte de ser uno
de los seleccionados para hacer una de las ponencias que tengo preparadas, con
título <em>El efecto &lsquo;este código es una basura&rsquo;</em>. Esta ponencia, preparada
esencialmente como mezcla entre show y realidad, resultó exitosa en el entorno
de confianza para el que fue creado, un entorno de amigos con los que comparto
experiencias, y practicamente mi vida en la oficina. El problema es que no lo
resultó tanto en un entorno un poco más desconocido como puede ser el de una
ponencia pública, donde no sabes quien te está escuchando.</p>

<p>Aquí están mis conclusiones y alguna que otra aclaración respecto mi ponencia.
Espero que sirva para otra gente que se hayan encontrado en mi misma situación
o que se vayan a encontrar, desafortunadamente, en un futuro.</p>

<h3>Deja clara tu intención</h3>

<p>Es importante que, antes de empezar, la gente sepa lo que va a encontrarse. Si
tu charla es un tanto distinta a las demás, cuenta el porqué y evita sorpresas
de última hora, como que el público no sepa encajar (por falta de información)
lo que estás explicando, como lo estás haciendo, o el punto de vista que estás
tomando.</p>

<p>Para mi, y tras la experiencia de ayer, es el punto más importante a tener en
cuenta.</p>

<p>En mi caso, hice una disertación completamente dramática. En ningún caso, y aún
estando en un evento de Drupal donde tendría sentido que hablara de Drupal,
quise enfocar mis críticas a ningún perfil en general, ni en ningún framework,
ni en ningún lenguaje.</p>

<p>Mi postura en toda la charla fue una simple abstracción y exageración (no tan
exagerada) de lo que uno se encuentra en la mayoría de empresas, profesionales
y humanos, porque al fin y al cabo, es lo que somos: humanos.</p>

<p>Una de las consecuencias de representar a esta sociedad es la necesidad de tener
la misma jerga que ella, en cuyo caso, no podemos dejar de pensar en palabrotas
o palabras mal sonantes (Muchas veces dejando el respeto de lado).</p>

<p>Esta fue mi intención ayer por la tarde, ponerme en la piel de todos y cada uno
de nosotros en nuestra intimidad (almenos, la mayoría, en mi opinión) y
analizar o ejemplificar como somos con lo que encontramos, y ver que aún siendo
críticos destructivos con las líneas de código que encontramos a nuestro paso, y
aún no entendiéndolas en mayor medida, somos nosotros mismos los primeros que
cometemos los mismos errores una y otra vez.</p>

<p>En la charla tuve distintos puntos de autocrítica, cosas que he hecho yo mismo
y cosas que he tenido que cambiar con el paso del tiempo, así que si en algún
momento fui crítico apuntando con el dedo, fue a mi persona.</p>

<h3>Tu charla nunca gustará a todo el mundo</h3>

<p>Miguel me lo decía, y suerte tengo de Miguel muchas veces, porque la perspectiva
que me suele dar él, poca gente me la da. <em>You know&hellip;</em></p>

<p>Al finalizar la disertación, con, por cierto, bastantes risas y algún que otro
aplauso, pensé que había sido un éxito. Para mí un éxito no es haber cambiado
la mentalidad de nadie, pues reconozco que soy el primer al que le cuesta
cambiar un hábito tan profundo como la calidad de tu propio código. Para mí, el
hecho que una de mis charlas sea un éxito es la suma de dos puntos:</p>

<ul>
<li>Que la gente se ría. Importante. La risa y el buen rollo es el calzador mágico
para que las palabras, aún siendo duras, suenen constructivas. En consecuencia
es la herramienta perfecta para proponer y compartir tu forma de pensar.</li>
<li>Que el mensaje llegue de alguna forma. La que sea, pero que llegue. La forma de ayer, la forma que creo que
puede llegar el mensaje de aceptar que la mayor parte de nuestro código no tiene
el rigor necesario, es haciendo uso de la ridiculización, la crítica y la jerga
convencional, social y humana. Estoy orgulloso de mi planteamiento, pues es la forma en la que
concebí inicialmente la estructura del mensaje.</li>
</ul>


<p>Mi sorpresa fue cuando varias personas luego me comentaron su desagrado. Entonces me dió que pensar
y llegué a todas estas conclusiones. También me consta que a la mayoría de las personas
le gustó lo que vió (al menos eso me han contado, de aquí a que sea verdad ya, es otro mundo).</p>

<p>Aún así, quiero pedir mis disculpas a todos aquellos que creyeron que era un ataque directo
a alguien, pues no fue así. Respeto a todo el mundo, haga lo que haga, y mucho más si lo que hace
, lo hace con ilusión. Respeto aún mucho más a todos aquellos que, y no conformándose con lo que tienen
buscan mucho más, aprendiendo lo que se pueda aprender de la mejor forma.</p>

<h3>Mejoras propuestas en mis charlas</h3>

<p>Me gusta hablar y no creo hacerlo mal. Reconozco que una de mis conclusiones impulsivas al
principio fue descansar de ponencias por un tiempo, pero es algo que necesito hacer
para equilibrar otra parte de mi trabajo.</p>

<p>A partir de ahora voy a cuidar mucho más las palabras que utilizo siempre que haga una
presentación, voy a comunicar muy bien el enfoque que voy a dar en las charlas y
intentaré, sin perder el buen humor con el que creo que no podría vivir, que sean
igual de dinámicas hasta ahora.</p>

<p>La ponencia en sí, he pedido que no la publiquen por razones obvias (No se si
me harán caso).</p>

<h3>Últimos pensamientos</h3>

<p>Poco más a añadir, creo que de los errores uno aprende, y agradezco tanto a todos los que
escucharon mi charla y se llevaron algo positivo a casa, como a los que no les gustó,
me lo hicieron saber y me hicieron reflexionar.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/15/what-makes-elcodi-different/">What Makes Elcodi Different?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-15T17:40:00+02:00" pubdate data-updated="true">May 15<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/05/15/what-makes-elcodi-different/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Well, the league of web development, in which we play, is a fussy league, I
started to recieve the first questions about the project I find myself
developing&hellip; ¿ Why a new project called Elcodi wants to cover the needs of
ecommerce when there is something similar called Sylius?</p>

<p>Although I twitt that I would write a comparison between both platforms, I
firmly believe that it is absurd to compare them, since Sylius is a
very mature project and has lots of features we do not have ( nor will we have
short-term ). So, this post is nothing more than a declaration of intentions
about why we have decided to start a separated project from the existing
options.</p>

<p>Firstly, I want to express complete respect to Sylius. It&rsquo;s a project
built by many different contributors, and I do not want to compare their
results with our ambitions at all. I think they both are projects with
different perspectives, and since one of our most important value ​​is humility,
we start as a small project. Ambitious, but for now, small.</p>

<p>Secondly, I&rsquo;d like to share with the community what I think are the three basic
pillars in our project. All three are equally important and we strongly believe
that one feeds the others. We are very strict on these three aspects, and it
will remain as it is throughout the years.</p>

<h2>Event-Driven Design</h2>

<p>Elcodi is a completely event-oriented project. All components have a set of
events, especially designed to customize the behavior of a specific action.</p>

<p>Not giving importance to this point means that many people will have to fork
the project itself to implement their own behaviors, and this is not a good
philosophy. A third party component should behave as such, giving a high degree
of customization.</p>

<h2>Clean Code</h2>

<p>Our first and most important objective is to provide developers with a set of
useful tools for working their own implementations. We do not claim to be the
all-purpose and immediate solution for existing projects. Our desire is to
provide a completely customizable workbench in order to solve those recurring
ecommerce projects problems.</p>

<p>For example, we can not deliver an all-inclusive Cart management solution for obvious reasons: each
project has its own unique business needs. What we can do is to propose a
simple common behavior, thus giving the opportunity to evolve by offering a
completely customizable model, giving the opportunity to extend behaviors thanks
to the proposed event structure and by offering a decent and growing documentation.</p>

<p>In my view, realistically, since real needs generate from a heterogeneous community
composed by people with different levels of skills and experience, we will just
collect these needs. Consequently, we will take care of the programming style,
clean code design and standardization so that every line of code can be understood
by everyone.
We are not die hard fans or disciples of any specific software development process
or methodology, we won&rsquo;t be relentlessy chasing latest trends just for the sake of it.
We just want to create a valuable project, both for developers who
want something nifty and stable for small quick project and for those who believe
that their e-commerce will grow much.</p>

<p>Working on an Elcodi based project must be fun and healthy.</p>

<h2>Business perspective</h2>

<p>We are a technology project, but first and foremost we are a company. This means
that though we aspire to be fully open source, we do have business model
behind, defined by a financial structure, which is based on constant growing.</p>

<p>As you can see on our website, our key role in the process is the Market. As said,
one of the great advantages that event-driven architecture gives us is that it can
easily be extended: third party modules will be simple to integrate.</p>

<p>Moreover, a professional team of developers will be responsible for the project,
to train interested people and review the quality of the extensions submitted
to the market.</p>

<p>At the same time, developers who wants to base their implementations on Elcodi
will likely find it easy to cover their needs, through open-source modules, market
extensions or by coding the solutions themselves (and of course selling it in the
Market if it complies with Elcodi code rules!)</p>

<p>Let me call this escenarios a win-win.</p>

<h2>Final thoughts</h2>

<p>I repeat myself. We do not want to compete with anyone. I understand that every
project has its trajectory. What appears in this post is our. Cross-project
collaboration is  essential, and we will commit to work alongside other projects,
because at last, everyone gains :)</p>

<p>Soon we will publish a roadmap, as well as a set of training modules
for people who want to learn some cookie recipes of web architecture and a
little more about our project.</p>

<p>If you want to know about project updates, follow our activities in
<a href="http://twitter.com/elcodi_dev">Twitter &ndash; @elcodi_dev</a> or follow Elcodi
development in <a href="http://github.com/elcodi/elcodi">Github &ndash; @elcodi</a>.</p>

<p>Obviously we want people to clone the project, inspect it, question us, discuss
constructively and give us reviews on our implementations. Contributions to the
project will be well received and appreciated :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/05/paramconverter-una-mala-idea/">ParamConverter&#8230; Mala Idea</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-05T13:18:00+02:00" pubdate data-updated="true">May 5<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/05/05/paramconverter-una-mala-idea/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Este problema ocurre en proyectos abiertos, open source. Para proyectos privados
donde Cart siempre será Cart, no creo que deba ser de su preocupación.</p>

<p>Cada vez tenemos más en mente trabajar con módulos que sean reutilizables. Las
buenas prácticas pasan por trabajar con interfaces y dar pie a que, el usuario
que tan amablemente está reutilizando nuestro código, pueda definir su dominio
según su especificación. Esto pasa, claro, por pensar que una entidad no siempre
será la misma entidad, el mismo objeto.</p>

<p>Me explicaré.</p>

<p>La buena práctica sugiere que cuando definimos una entidad con sus relaciones,
utilizemos un ResolveTargetEntityListener. Lo que hace este listener es, una vez
se han definido las relaciones utilizando interfaces, se resuelven éstas y se
sustituyen por entidades reales ( evidentemente por entidades que implementan
tales interfaces ).</p>

<p>Cuando se sigue esta estrategia, es natural definir tanto el namespace como
el factory de la entidad que estás utilizando en un parámetro de bundle, por lo
que se puede sobrescribir fácilmente en cada uno de los proyectos.</p>

<p>Vemos un ejemplo.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">Elcodi\CartBundle\Entity\Cart</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">entity</span>
</span><span class='line'>    <span class="l-Scalar-Plain">repositoryClass</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\CartBundle\Repository\CartRepository</span>
</span><span class='line'>    <span class="l-Scalar-Plain">table</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">cart</span>
</span><span class='line'>
</span><span class='line'>    <span class="l-Scalar-Plain">oneToOne</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">order</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="l-Scalar-Plain">targetEntity</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\CartBundle\Entity\Interfaces\OrderInterface</span>
</span><span class='line'>            <span class="l-Scalar-Plain">mappedBy</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">cart</span>
</span></code></pre></td></tr></table></div></figure>


<p>En este caso, la relación con Order es débil, ya que la proponemos con cualquier
entidad que implemente OrderInterface. Solo hace falta que el
ResolveTargetEntityListener proponga una implementación para OrderInterface, en
nuestro caso, <code>Elcodi\CartBundle\Entity\Order</code>.</p>

<p>En nuestro config, definimos los namespaces de las entidades con las que vamos a
trabajar.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># Entities</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="l-Scalar-Plain">elcodi.core.cart.entity.cart.class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\CartBundle\Entity\Cart</span>
</span><span class='line'>    <span class="l-Scalar-Plain">elcodi.core.cart.entity.order.class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\CartBundle\Entity\Order</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># Factories</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="l-Scalar-Plain">elcodi.core.cart.factory.cart.class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\CartBundle\Factory\CartFactory</span>
</span><span class='line'>    <span class="l-Scalar-Plain">elcodi.core.cart.factory.order.class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Elcodi\CartBundle\Factory\OrderFactory</span>
</span></code></pre></td></tr></table></div></figure>


<p>Este escenario anuncia lo que el título de este post enuncia. Hardcodear el
namespace de una entidad en alguna parte, rompe toda esta estrategia. Si
trabajamos de esta forma &ldquo;abstracta&rdquo; no nos podemos permitir el lujo de marcar
con sangre que una entidad siempre será de un tipo específico, y es, en
realidad, lo que obliga el ParamConverter</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">use</span> <span class="nx">Sensio\Bundle\FrameworkExtraBundle\Configuration\Route</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Sensio\Bundle\FrameworkExtraBundle\Configuration\ParamConverter</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @Route(&quot;/cart/{id}&quot;)</span>
</span><span class='line'><span class="sd"> * @ParamConverter(&quot;cart&quot;, class=&quot;ElcodiCartBundle:Cart&quot;)</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Proposición</p>

<p>Para que el ParamConverter funcionara de tal forma que pudiéramos salvar este
problema, deberíamos poder definir nuestra entidad con un parameter. Algo así:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">use</span> <span class="nx">Sensio\Bundle\FrameworkExtraBundle\Configuration\Route</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Sensio\Bundle\FrameworkExtraBundle\Configuration\ParamConverter</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @Route(&quot;/cart/{id}&quot;)</span>
</span><span class='line'><span class="sd"> * @ParamConverter(&quot;cart&quot;, class=&quot;%elcodi.core.cart.entity.cart.class%&quot;)</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Esto implica que se debería inyectar el Container entero en el servicio que
trabaja los paramconverter de Doctrine, y que deberíamos checkear siempre si
el parámetro que se pasa es un namespace o un nombre de un parámetro.</p>

<p>Tal vez tendría sentido poder trabajar con ExpressionLanguage, pero el problema
es que añades una relación mas al bundle, por lo que no creo que les guste a los
autores del bundle ( SensioLabs ).</p>

<p>Con este post no quiero abrir un debate sobre si las annotations están bien o
no. Soy el primero que las he defendido en su momento, otorgando siempre su
utilidad en ciertos entornos y en ciertos casos. Ahora que empiezo a trabajar en
un entorno 100% OpenSource ya no valen tanto como antes.</p>

<p>Que creéis al respecto? Olvidaríais las annotations al 100 en entornos Open
Source?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/29/elcodi-a-new-symfony-adventure/">Elcodi, a New Symfony Adventure</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-29T16:10:00+02:00" pubdate data-updated="true">Apr 29<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/04/29/elcodi-a-new-symfony-adventure/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some changes are about to come. And it seems that they are good
changes. I haven’t written in my blog for a few weeks, and the truth is
I feel bad about it. I like to write about the things that happen to me at
the company; about the problems we find and the solutions I come up
with. The thing is that, for some months now, I’ve been really focused
on the project that we are launching to the world today. Initially, it is
a project by developers for developers, focused on meeting the actual
needs of developers who design and program e-commerce.</p>

<p>It is true that we have plenty of platforms and options to develop e-
commerce around the world. I could name a few, and probably they all
have outstanding metrics and KPIs.</p>

<p>The problem with these platforms is that they are entirely B2B, so
they only make sense when the end user just needs to have a good
management, installation and configuration interface; and when
technical departments want to develop, both horizontally (new features
for things already in use, or just customization) and vertically (new
features), these B2B platforms fall short, and so the company must
either pay a lot of money in refactoring, or the existing code must be
touched, contaminating it and putting its integrity at risk.</p>

<p>These platforms are usually not tested, and so each line added is
potentially harmful for the whole system. Then, each development
on these platforms usually results in collateral problems in the user
experience itself.</p>

<p>As I see it, this is unacceptable in our times.
We propose a platform conceived for developers, thought of and deeply
reflected on. This does not mean that the code is right from the very
start; our declaration of intent is simply to take this project to a certain
point where companies can trust in the project in order to build their
own.</p>

<p>We present you <a href="http://elcodi.io">Elcodi</a>.</p>

<p>We are just beginning to emerge with an approach divided into phases.
Our roadmap is very clear to us, and so in the next few months we
will develop the main features at a core level, as well as the necessary
robustness in order to deal with any outsourcers who like the project in
its initial stage and wish to join us in this journey, aimed at improving
the lifestyle of developers.</p>

<p>The platform is based on Symfony2 and, following the philosophy
defined by its own framework, we have focused most of the
architecture by using a strong layer of events, fully uncoupling most
behaviours and components.</p>

<p>If you are a Symfony programmer, I suggest that you check it out. You
will see errors, a thousand things left to develop and to improve; but,
like with all projects, our greatest ambition is its own construction;
therefore, it’s a matter of months, energy and development.
Another of our objectives is building a good documentation.</p>

<p>Essentially, we have three documentation lines in mind. Firstly, we
want to communicate our philosophy to other people; the direction
the project will undoubtedly take, regardless of its implementation
in a given moment. It is important to define this from the beginning,
because to a great extent it links us to our target audience.
Documentation is a slow process, which is also subject to collaboration,
and at first it will be in English only.</p>

<p>Finally, I should say that elcodi.com is a rapidly expanding company.
We have good growth projections, and so we are certain that what we
are starting today with such enthusiasm will not cease to grow.
We want it to be useful; we want our proposal to be seen by everybody,
to get your most constructive criticism, since only in this way we can
really make an interesting project for us all.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/28/camino-hacia-drupal8/">Camino Hacia Drupal8</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-28T16:27:00+02:00" pubdate data-updated="true">Apr 28<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/04/28/camino-hacia-drupal8/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Debo reconocer que 12 horas de avión son muchas horas. Sobretodo porque, aún
teniendo formas de distraerse ( Asumo de raiz que no se puede dormir&hellip; Podría
enumerar infinidad de razones&hellip; niños gritando, llorando o jugando, asientos
muy pequeños para la gente alta como yo&hellip; ) el reconocido JetLag desgasta toda
la semana posterior al viaje.</p>

<p>El tema es que, a pesar de todo, cuando la razón del viaje no es otra que
conocer compañeros nuevos, conocer una comunidad, una cultura, un país, una
gastronomía, unas costumbres&hellip; cuando la razón es mucho más que un simple
viaje de placer, estas horas pesadas pasan a ser lo de menos.</p>

<p>Hoy he vuelto de México tras una maravillosa semana en el DF, exactamente en el
DrupalCamp México 2014. Mi misión, hablar de Symfony a una comunidad que todavía
no lo tiene claro, viendo como su proyecto evoluciona a otro nivel.</p>

<p>Os pongo en contexto.</p>

<p>Drupal es un proyecto escrito en PHP4. Como wordpress, su core y su filosofía
se basas en un sistema de módulos instalables, reemplazando lo que nosotros
llamamos <em>Event Layer</em> por los ya mas que personalmente olvidados <em>Hooks</em>.
El código está lleno de los llamados Drupalismos, un término creado y designado
a los <em>Coding Standards</em>, tanto en su forma como en su estructura en el cual se
basa todo el proyecto.</p>

<p>Personalmente, muy mejorable.</p>

<p>Quiero aclarar de raiz que todo lo que añado a continuación es una simple
opinión. Mi punto de vista sobre el contexto social que se vive en todo el
continente latinoamericano, y en toda la comunidad Drupal.</p>

<p>Siguiendo con el contexto, la versión estable de drupal actual es la 7. Drupal7
es, ha sido y será la última major release Drupal en lenguaje PHP4,
así que en la nueva versión, Drupal8, algunos módulos de Symfony2 se añadirán
como dependencias. Encontramos algo tan útil como el EventDispatcher ( En
Drupal8 aún coexistirán tanto los Hooks como el EventDispatcher, y en la versión
Drupal9, los hooks se eliminarán de forma completa y permanente ), el Routing,
el HttpFoundation, el HttpKernel, el DependencyInjection&hellip;</p>

<p>Al parecer tal decisión ha dividido la comunidad en dos.</p>

<p>Por un lado tenemos la gente que no quiere pasar a Drupal8, alegando complejidad
demasiado elevada en la transición y un BC completo en ambas versiones. En este
colectivo se ha fundado el proyecto <a href="http://backdropcms.org/">Backdrop</a>, un CMS
evolucionado de Drupal7, con la misma filosofía de arquitectura, y con un cambio
en la forma de trabajar ( Sistema de releases, de features ) y por consiguiente,
con una comunidad estructurada.</p>

<p>Por otro lado tenemos a los que ven a Drupal8 como una posibilidad para
renovarse, para aventurarse en lo desconocido, aprender y resolver aquella deuda
técnica que han generado durante tanto años, apostando tal vez demasiado por la
flexibilidad que propone Drupal desde hace tiempo.</p>

<p>Yo les conocí, a ambos, en el mismo lugar.</p>

<p>En este post quiero defender la evolución de un colectivo, la evolución de
personas que muy honradamente quieren ganarse la vida, y a la par, aprender a
programar utilizando las últimas tendencias en diseño, los patrones más
innovadores, apostando por un modelo sostenible, colaborativo y
completamente escalable.</p>

<p>Yo creo en el crecimiento personal como parte de un crecimiento superior, el de
una comunidad. Les conocí en el Camp y me transmitieron ganas de aprender, ganas
de adquirir conocimientos que, aparentemente, tanto cuesta adquirir. Tengo que
admitir que defender el primer colectivo es una cuestión de mediocridad muy
lícita ( como toda alternativa en el momento que, almenos a uno, le soluciona
un problema ). Defender el mero hecho de no evolucionar, me hace reflexionar
en que tal vez no se den cuenta que solo ellos son capaces de cambiar
el mundo, y estando en sus manos este cambio tan grande, deciden quedarse con lo
que &ldquo;ya funciona&rdquo;. El &ldquo;ya está bien, para que cambiarlo&rdquo; no forma parte de
mi filosofía profesional, y por lo tanto, es imposible que llegue a lidiar
con ella.</p>

<p>Todo gran cambio requiere de un gran sacrificio. Todo gran aprendizaje requiere
un gran cambio, por lo que sacrificarte solo aporta nutrirse de nuevas opciones,
herramientas para el buen escultor, cuya ambición no es otra que tallar la
figura perfecta.</p>

<p>Señores de <em>backdrop</em>, ustedes solo quieren seguir dotando a una comunidad
gigante con un palo de madera para tallar figuras renacentistas. Me parece
ridículo. Me parece prehistórico.</p>

<p>El hombre tuvo que aprender a hacer fuego de una simple rama, y ahora somos una
sociedad avanzada, en gran parte, por que podemos iluminar una habitación oscura
de la forma más primitiva.</p>

<p>Señores de <em>backdrop</em>, ustedes quieren seguir aceptando que PHP4 es válido, y no
lo es. Si fuera por PHP4, si fuera por la negación de la evolución cuando la POO
apareció antaño, hoy en día seríamos incapaces de hablar de Dependency
Injection, de arquitecturas hexagonales y de patrones de diseño avanzados, cuya
función desde el mismo día de su proposición no ha sido otra que hacer
evolucionar al pensador, al escultor, al programador.</p>

<p>Y creo que lo ha conseguido, con creces.</p>

<p>Y es que todo ser humano es simple. Si damos opciones, elige mal. Si proponemos
efectivamente el hecho de seguir siendo mediocre, el ser humano verá en esta
opción su zona de comfort, y no evolucionará.</p>

<p>Por qué no utilizan esta energía para mover masas? Por qué no utilizan esta
fuerza que tan bien utilizan en quejarse, para ser el referente de un pueblo en
su camino hacia un nuevo punto de partida?</p>

<p>Finalmente, un mensaje al desarrollador Drupal indeciso. ¿Por qué teniendo
herramientas para hacer catedrales magníficas, se empeñan en hacer chozas de
madera? ¿Por qué no pasar al siguiente nivel?</p>

<p>Pues exactamente están en esta posición. ¿Acaso se creen que se hallarán solos en
este mar llamado desconocimiento? Tienen la oportunidad de crecer juntos como
comunidad hacia un objetivo común, mejorar, sea como sea. Yo no lo pensaría mas
de dos veces&hellip;</p>

<p>Sean valientes, interés es el pretexto del conocimiento y del éxito, así que les
animo a que den una oportunidad al progreso, a su capacidad, a que
Drupal8 y Symfony sean su tarjeta de embarque para su éxito personal y
profesional, así como un acceso directo a una comunidad proactiva y
colaborativa.</p>

<p>Aquí estaremos los que ya hemos sufrido para que su camino sea un poco más leve.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/17/elcodi/">Elcodi, Una Nueva Aventura en Symfony2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-17T12:46:00+02:00" pubdate data-updated="true">Apr 17<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/04/17/elcodi/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ciertos cambios están por llegar. Y parece ser que son cambios buenos. Llevo
unas cuantas semanas sin escribir en el blog, y la verdad es que me sabe mal.
Me gusta contar cosas que me van sucediendo en la empresa. Problemas que nos
vamos encontrando y soluciones que se me van ocurriendo. El problema es que
llevo unos meses muy centrado en el proyecto que justo hoy lanzamos al mundo.
Es un proyecto inicialmente de desarrolladores para desarrolladores, centrado en
cubrir necesidades reales de los developers destinados a diseñar y
programar ecommerces.</p>

<p>Es cierto que tenemos muchísimas plataformas y opciones para desarrollar
ecommerces alrededor del mundo. Podría enumerar unos cuantos, y probablemente
todos tengan unas métricas y unos KPIs magníficos.</p>

<p>Los problemas de estas plataformas es que son completamente B2B, por lo que tienen sentido cuando
el usuario final simplemente debe tener una buena interfaz de administración,
de instalación y de configuración; y que cuando los departamentos técnicos quieren
desarrollar, tanto horizontalmente ( nuevas funcionalidades de
aquello que ya se está utilizando, o simplemente customizar ) como verticalmente
( nuevas funcionalidades ), estas plataformas B2B se quedan
cortas, por lo que la empresa tiene que desembolsar una cantidad enorme de
dinero en un refáctoring, o simplemente, se debe empezar a todar el código
existente, ensuciándolo y haciendo peligrar su integridad.</p>

<p>Estas plataformas no suelen estar testeadas, por lo que cada línea que se añade
es una línea potencialmente dañina para todo el sistema, con lo que cada
desarrollo sobre estas plataformas suelen derivar en problemas colaterales
en la propia experiencia de usuario.</p>

<p>Desde mi punto de vista, en los tiempos que corren, esto es inaceptable.</p>

<p>Nosotros proponemos una plataforma pensada para los desarrolladores, pensada
y profundamente reflexionada. Esto no implica que el código deba estar bien
en una primera instancia, simplemente nuestra declaración de intenciones es
llevar el proyecto a un punto donde las empresas puedan confiar en el proyecto
para construir el suyo propio.</p>

<p>Os presentamos <a href="http://elcodi.io">Elcodi</a>.</p>

<p>En un planteamiento dividido en fases, justo estamos naciendo. Tenemos muy claro
cual es nuestro roadmap, por lo que en los próximos meses se desarrollaran las
principales features a nivel de core, así como la robustez necesaria como para
poder lidiar con colaboradores externos, que les guste el proyecto en su estado
inicial y que quieran acomparnos en este viaje, destinado a mejorar el estilo de
vida de los developers.</p>

<p>La plataforma está basada en Symfony2, y siguiendo la filosofía definida por el
propio framework, hemos enfocado la mayor parte de la arquitectura utilizando
una fuerte capa de eventos, desacoplando la mayoría de comportamientos y
componentes completamente.</p>

<p>Si eres programador Symfony, te propongo que almenos le eches un vistazo.
Verás errores, mil cosas a desarrollar y mil cosas a mejorar, pero como todo
proyecto, nuestra mayor ambición es la propia construcción del mismo, por lo que
es cuestión de meses, ganas y desarrollo.</p>

<p>Otro de nuestros objetivos es llegar a construir una buena documentación.
Tenemos esencialmente tres líneas de documentación en mente. Por un lado</p>

<p>queremos transmitir a los demás nuestra filosofía. La dirección que, sin duda
alguna, tomará el proyecto, independientemente de la implementación que este
adquiera en un momento dado. Es importante definir esto inicialmente porque al
final nos vincula muchísimo al target al que vamos destinados.</p>

<p>La documentación es algo lento, también sujeta a colaboraciones, y en principio
estará inicialmente solo en inglés.</p>

<p>Finalmente decir que elcodi.com es una empresa en plena expansión. Tenemos
buenas previsiones de crecimiento por lo que tenemos una garantía que lo que hoy
con tanta ilusión estamos empezando, no dejará de crecer.</p>

<p>Queremos que sea útil, queremos que nuestra propuesta esté a juicio de todo el
mundo y que saque vuestras críticas mas constructivas, solo así podremos
realmente hacer un proyecto interesante para todos.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/11/custom-controller-annotations/">Custom Controller Annotations</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-11T20:21:00+01:00" pubdate data-updated="true">Feb 11<span>th</span>, 2014</time>
        
         | <a href="/blog/2014/02/11/custom-controller-annotations/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The goal is easy: To provide a very intuitive and easy way of creating
controller annotations in Symfony2.</p>

<p><a href="https://github.com/mmoreram/ControllerExtraBundle">ControllerExtraBundle</a>
is both a set of annotations and a platform for creating new custom ones.
Actually, the bundle can create a new Entity, like ParamConverter does, with in
this case is just an empty Entity. The bundle also can create FormTypes, Forms
and FormViews with several options. Can also automate the doctrine <code>flush()</code>
action after the method execution or log something before / after every desired
action.</p>

<p>Bundle is still being tested in production environments, all feedback will be
very very useful.</p>

<p>Let&rsquo;s see how can we create our Annotations.</p>

<ul>
<li>Annotation</li>
<li>Resolver</li>
<li>Definition</li>
<li>Registration</li>
</ul>


<h2>Annotation</h2>

<p>The annotation object. You need to define the fields your custom annotation
will contain.
Must extends <code>Mmoreram\ControllerExtraBundle\Annotation\Abstracts\Annotation</code>
abstract class.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">My\Bundle\Annotation</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Mmoreram\ControllerExtraBundle\Annotation\Abstracts\Annotation</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Entity annotation driver</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @Annotation</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">MyCustomAnnotation</span> <span class="k">extends</span> <span class="nx">Annotation</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var string</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Dummy field</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$field</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Get Dummy field</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return string Dummy field</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getField</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Resolver</h2>

<p>Once you have defined your own annotation, you have to resolve how this
annotation works in a controller. You can manage this using a Resolver. Must
extend <code>Mmoreram\ControllerExtraBundle\Resolver\Interfaces\AnnotationResolverInterface;</code>
abstract class.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">My\Bundle\Resolver</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Mmoreram\ControllerExtraBundle\Resolver\Interfaces\AnnotationResolverInterface</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Mmoreram\ControllerExtraBundle\Annotation\Abstracts\Annotation</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * MyCustomAnnotation Resolver</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">MyCustomAnnotationResolver</span> <span class="k">implements</span> <span class="nx">AnnotationResolverInterface</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Specific annotation evaluation.</span>
</span><span class='line'><span class="sd">     * This method MUST be implemented because is defined in the interface</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param Request          $request    Request</span>
</span><span class='line'><span class="sd">     * @param Annotation       $annotation Annotation</span>
</span><span class='line'><span class="sd">     * @param ReflectionMethod $method     Method</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return MyCustomAnnotationResolver self Object</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">evaluateAnnotation</span><span class="p">(</span>
</span><span class='line'>                                        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
</span><span class='line'>                                        <span class="nx">Annotation</span> <span class="nv">$annotation</span><span class="p">,</span>
</span><span class='line'>                                        <span class="nx">ReflectionMethod</span> <span class="nv">$method</span> <span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * You can now manage your annotation.</span>
</span><span class='line'><span class="sd">         * You can acced to its fields using public methods.</span>
</span><span class='line'><span class="sd">         * </span>
</span><span class='line'><span class="sd">         * Annotation fields can be public and can be acceded directly,</span>
</span><span class='line'><span class="sd">         * but is better for testing to use getters; they can be mocked.</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="nv">$field</span> <span class="o">=</span> <span class="nv">$annotation</span><span class="o">-&gt;</span><span class="na">getField</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * You can also access to existing method parameters.</span>
</span><span class='line'><span class="sd">         * </span>
</span><span class='line'><span class="sd">         * Available parameters are:</span>
</span><span class='line'><span class="sd">         * </span>
</span><span class='line'><span class="sd">         * # ParamConverter parameters ( See `resolver_priority` config value )</span>
</span><span class='line'><span class="sd">         * # All method defined parameters, included Request object if is set.</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="nv">$entity</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;entity&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * And you can now place new elements in the controller action.</span>
</span><span class='line'><span class="sd">         * In this example we are creating new method parameter</span>
</span><span class='line'><span class="sd">         * called $myNewField with some value</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span>
</span><span class='line'>            <span class="s1">&#39;myNewField&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="k">new</span> <span class="nv">$field</span><span class="p">()</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This class will be defined as a service, so this method is computed just
before executing current controller. You can also subscribe to some kernel
events and do whatever you need to do ( You can check
<code>Mmoreram\ControllerExtraBundle\Resolver\LogAnnotationResolver</code> for some
examples.</p>

<h2>Definition</h2>

<p>Once Resolver is done, we need to define our service as an Annotation
Resolver. We will use a custom <code>tag</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># Resolvers</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="l-Scalar-Plain">my.bundle.resolvers.my_custom_annotation_resolver.class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">My\Bundle\Resolver\MyCustomAnnotationResolver</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># Resolvers</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="l-Scalar-Plain">my.bundle.resolvers.my_custom_annotation_resolver</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="err">%</span><span class="l-Scalar-Plain">my.bundle.resolvers.my_custom_annotation_resolver.class%</span>
</span><span class='line'>        <span class="l-Scalar-Plain">tags</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">controller_extra.annotation</span> <span class="p-Indicator">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Registration</h2>

<p>We need to register our annotation inside our application. We can just do it in
the <code>boot()</code> method of <code>bundle.php</code> file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">My\Bundle</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\Bundle\Bundle</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Doctrine\Common\Annotations\AnnotationRegistry</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * MyBundle</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ControllerExtraBundle</span> <span class="k">extends</span> <span class="nx">Bundle</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Boots the Bundle.</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$kernel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;kernel&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">AnnotationRegistry</span><span class="o">::</span><span class="na">registerFile</span><span class="p">(</span><span class="nv">$kernel</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">locateResource</span><span class="p">(</span><span class="s2">&quot;@MyBundle/Annotation/MyCustomAnnotation.php&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Et voilà!</em>  We can now use our custom Annotation in our project controllers.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/03/cache-clear-en-symfony2/">Cache Clear en Symfony2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-03T15:11:00+01:00" pubdate data-updated="true">Jan 3<span>rd</span>, 2014</time>
        
         | <a href="/blog/2014/01/03/cache-clear-en-symfony2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Vacía la caché de Symfony, y la vuelve a crear (sino se especifica lo contrario)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>php app/console cache:clear <span class="o">[</span>--no-warmup<span class="o">]</span> <span class="o">[</span>--no-optional-warmers<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Curioso comando existente en el framework Symfony2 desde sus inicios, y poco
utilizado por los proyectos. En realidad, he visto pocos proyectos que utilizen
este comando en los scripts de deploy, por lo que lo más habitual que veremos es
el clásico</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rm -Rf app/cache/*
</span></code></pre></td></tr></table></div></figure>


<p>Pero es correcta esta práctica? Aunque parezca la forma más ágil de limpiar
cache, tengamos en cuenta que Symfony2 tiene procesos internos que muchos de
nosotros desconocemos por completo. Cuando ejecutamos el comando para vaciar
caché ( con la opción <code>--no-warmup</code> ) no tan solo vaciamos el directorio caché
sino que el framework ejecuta el método <code>clear()</code> de todos los servicios que
implementan la interface
<code>Symfony\Component\HttpKernel\CacheClearer\CacheClearerInterface</code> cuya
definición incorporen el tag <code>kernel.cache_clearer</code>.</p>

<p>En otras palabras.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">my_cache_clearer</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Acme\MainBundle\Cache\MyClearer</span>
</span><span class='line'>        <span class="l-Scalar-Plain">tags</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">kernel.cache_clearer</span> <span class="p-Indicator">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Encontraréis mas información y especificación de estos tags
<a href="http://symfony.com/doc/current/reference/dic_tags.html#kernel-cache-clearer">aqui</a>.</p>

<h2>Reflexión</h2>

<p>En realidad es importante fijarse en la opción <code>--no-warmup</code> ya que es la que
cambia el comportamiento del comando. Cuando trabajamos en entornos de
producción, necesitamos que, en tiempo de deploy, nuestra aplicación tenga el
mínimo tiempo de downtime. Esto se consigue reduciendo al máximo el tiempo en
que una caché está vacía.</p>

<h3>Tabla básica de tiempos</h3>

<blockquote><ul>
<li>[1]   Repository status: S1, Cache status: C1</li>
<li>[1-3] Deploy S1 &ndash;> S2</li>
<li>[3-4] Clear cache C1 from /cache</li>
<li>[4-7] Warm up new cache C2 into /cache_new</li>
<li>[7-8] Swap cache C1 &ndash;> C2. Rename /cache_new to /cache</li>
<li>[8]   Repository status: S2, Cache status: C2</li>
</ul>
</blockquote>

<h3>Problema 1</h3>

<p>Entre los tiempos 3 y 8, tenemos que /cache está vacía. Tenemos que tener en
cuenta que estamos en un entorno de producción, por lo que mientras hacemos el
proceso de deployment, nuestros servidores deben estar sirviendo peticiones en
todo momento.</p>

<p>Dado este caso, cada una de las peticiones se dará cuenta que la caché está
vacía, por lo que intentará volverla a montar desde cero. Deberíamos tener en
cuenta, entonces, que entre los tiempos 3 y 8, nuestro servicio estará caido.</p>

<p>De este análisis sacamos que debemos minimizar al máximo el tiempo pasado entre
el clear de la caché a invalidar y el switch a la nueva, o sea, reducir este
intervalo en el que nuestra caché está vacía.</p>

<p>Hace pocos dias propuse un
<a href="https://github.com/symfony/symfony/pull/9930">PR a FrameworkBundle</a> para
gestionar esto.</p>

<p>Lo único que hace es cambiar el orden entre el warm up de la nueva caché y el
clear de la vieja.</p>

<blockquote><ul>
<li>[1]   Repository status: S1, Cache status: C1</li>
<li>[1-3] Deploy S1 &ndash;> S2</li>
<li>[3-6] Warm up new cache C2 into /cache_new</li>
<li>[6-7] Clear cache C1 from /cache</li>
<li>[7-8] Swap cache C1 &ndash;> C2. Rename /cache_new to /cache</li>
<li>[8]   Repository status: S2, Cache status: C2</li>
</ul>


<p>Downtime 2</p></blockquote>

<p>En este punto podemos ver que la ventana que separa el clear de la caché antigua
y el switch con la nueva solo es de dos unidades de tiempo, entre los tiempos 6
y 8. Ahora se nos plantea otro problema.</p>

<h3>Problema 2</h3>

<p>Hemos minimizado al máximo el tiempo de switch entre las dos caches, pero
seguimos teniendo una ventana de 5 unidades de tiempo entre que el repositorio
está en un estado S2 y la caché en un estado C1.</p>

<blockquote><p>Real downtime 5</p></blockquote>

<p>En realidad, dado este análisis solo podríamos actuar de una sola forma, y es
trabajar con un deployment paralelo ( como hace el warmup del cache:clear ).
Esto significa que nunca deployamos sobre nuestra instalación activa</p>

<blockquote><ul>
<li>[1]   Repository status: S1, Cache status: C1 en /project</li>
<li>[1-8] Deployment Repository + cache:clear en /project_warmup</li>
<li>[8]   Repository status: S2, Cache status: C2 en /project_warmup</li>
<li>[8-9] Swap repository S1 &ndash;> S2. Rename /project to /project_warmup</li>
</ul>


<p>Downtime: 0</p></blockquote>

<h3>Problema 3</h3>

<p>En este caso es probable que nuestro proceso de deploy nos modifique elementos
externos, como puede ser ( y probablemente sea ) <code>mysql</code>. Entonces tendremos una
ventana bastante grande donde el modelo deployado en mysql que haga S2 no se
asemeje al modelo Doctrine de S1.</p>

<blockquote><p>Downtime: X</p></blockquote>

<p>So what? Como lo hacéis vosotros? Ya es por sondear un poco hacia donde tira la
gente&hellip;</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/05/22/las-modas-y-los-modelos-me-tienen-fritos/">Las modas y sus modelos me tienen frito</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/20/about-rules-and-expression-language/">Sobre reglas y ExpressionLanguage</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/19/restrospectiva/">Restrospectiva de un ponente</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/15/what-makes-elcodi-different/">What makes Elcodi different?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/05/paramconverter-una-mala-idea/">ParamConverter&#8230; mala idea</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/mmoreram">@mmoreram</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mmoreram',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

      </div>
    </div>
    <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Marc Morera -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>. Design by <a href="http://octopressthemes.com">Octopress Themes</a>.</span>
</p>

</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'mmoreram';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </div>
</body>
</html>
