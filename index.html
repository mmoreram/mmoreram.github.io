
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Because yes</title>
  <meta name="author" content="Marc Morera">

  
  <meta name="description" content="This post is under revision. Some projects using PHP 5.4 are actually using Traits. If you don&rsquo;t know yet
what a trait is, there are some &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mmoreram.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Because yes" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=Raleway:100" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic|Istok+Web:400,400italic,700,700italic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-41917921-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
  <div id="header-container">
    <div id="header">
      <div class="wrapper">
        <header role="banner"><hgroup>
  <h1><a href="/">Because yes</a></h1>
</hgroup>

</header>
        <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mmoreram.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
      </div>
    </div>
  </div>
  <div id="body"   >
    <div id="main">
      <div id="content">
	<div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/16/namespaces-in-traits/">Namespaces in Traits</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-10-16T12:32:00+02:00" pubdate data-updated="true">Oct 16<span>th</span>, 2015</time>
        
         | <a href="/blog/2015/10/16/namespaces-in-traits/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>This post is under revision.</p></blockquote>

<p>Some projects using PHP 5.4 are actually using Traits. If you don&rsquo;t know yet
what a trait is, there are some interesting links for you.</p>

<ul>
<li><a href="https://secure.php.net/manual/en/language.oop5.traits.php">https://secure.php.net/manual/en/language.oop5.traits.php</a></li>
<li><a href="http://www.sitepoint.com/using-traits-in-php-5-4/">http://www.sitepoint.com/using-traits-in-php-5-4/</a></li>
<li><a href="http://www.sitepoint.com/php-traits-good-or-bad/">http://www.sitepoint.com/php-traits-good-or-bad/</a></li>
</ul>


<p>This post is about the usage of &ldquo;use statements&rdquo; in Traits, like this example</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">namespace</span> <span class="nx">SomeProject</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">SomeProject\SomeObject</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * My trait</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">trait</span> <span class="nx">MyTrait</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Do something</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param SomeObject $someObject Some object instance</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nx">SomeObject</span> <span class="nv">$someObject</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Do things...</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Is that implementation good enough?</p>

<h2>TL;DR</h2>

<ul>
<li>Never use &ldquo;use statements&rdquo; in Traits. Never.</li>
</ul>


<h2>The overall picture</h2>

<p>When you work on open source, you learn to think about the overall picture. This
means that, probably, your code will somehow, somewhere, part of something even
bigger. Your code must be ready for that.</p>

<p>Let&rsquo;s work with the first shown example. This implementation is correct, right?
I mean, it seems correct because we are not thinking with the global design of
something bigger than our project.</p>

<p>When you work on open source, you learn as well some basic rules. These rules
are based on the reality of sharing. People share their work, and sometimes
means that you will never know what packages will coexist with your own package.</p>

<p>Remember that.</p>

<h2>Friendly packages</h2>

<p>Because our package should be able to work with other unknown packages, then we
should design our packages as much isolated as possible. A friendly package is
the one that can live with all type of external packages, even if they are not
friendly at all.</p>

<p>Let me show you why our first example is not friendly at all.
First of all let&rsquo;s see our package again.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">namespace</span> <span class="nx">SomeProject</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">SomeProject\SomeObject</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * My trait</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">trait</span> <span class="nx">MyTrait</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Do something</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param SomeObject $someObject Some object instance</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nx">SomeObject</span> <span class="nv">$someObject</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Do things...</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This trait assumes too many things, and because of that, is not friendly at all.
We&rsquo;ll see soon why this implementation can make itself completely non-usable by
many projects.</p>

<p>Let&rsquo;s see another third party project, with another trait, providing us another
useful behavior.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">namespace</span> <span class="nx">AnotherProject</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">AnotherProject\SomeObject</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * My another trait</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">trait</span> <span class="nx">MyAnotherTrait</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Do another thing</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param SomeObject $someObject Some object instance</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">soAnotherThing</span><span class="p">(</span><span class="nx">SomeObject</span> <span class="nv">$someObject</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Do things...</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, this class belongs to another isolated project, so each one will
work properly in its own sandbox. Until now, everything works perfectly&hellip; but
remember when we were talking about the overall picture? In the real world, this
last example is what happens.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">namespace</span> <span class="nx">ThirdPartyProject</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">SomeProject\MyTrait</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">AnotherProject\MyAnotherTrait</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * My super class</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">MySuperClass</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">use</span> <span class="nx">MyTrait</span><span class="p">;</span>
</span><span class='line'>    <span class="k">use</span> <span class="nx">MyAnotherTrait</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>What happens here?
Well, as you may know (otherwise, please read about Traits), a Trait is
considered as a simple copy/paste action inside a class. That means that, on the
one hand, all &ldquo;use statements&rdquo; are copied one by one on the top of the main
object, and on the other, all methods, with some priorities considerations, are
copied inside the main class.</p>

<p>So, our last example equals that new one.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">namespace</span> <span class="nx">ThirdPartyProject</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">SomeProject\SomeObject</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">AnotherProject\SomeObject</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * My super class</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">MySuperClass</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Do something</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param SomeObject $someObject Some object instance</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nx">SomeObject</span> <span class="nv">$someObject</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Do things...</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Do another thing</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param SomeObject $someObject Some object instance</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">soAnotherThing</span><span class="p">(</span><span class="nx">SomeObject</span> <span class="nv">$someObject</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Do things...</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Oh, wait&hellip; can you see that?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">use</span> <span class="nx">SomeProject\SomeObject</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">AnotherProject\SomeObject</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you may think, this is ilÂ·legal in PHP.</p>

<h2>Complete namespaces</h2>

<p>Considering that all traits should be friendly then, the best solution here is
avoiding namespaces. You could tell right now&hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>- Oh, well Marc, you can have this problem as well with methods. What happens if
</span><span class='line'>  two traits have same method definitions?
</span><span class='line'>
</span><span class='line'>- Well, when you use a trait, then you should revise these parts that it offers
</span><span class='line'>  you (class signature, methods signature...). You should not take in account if
</span><span class='line'>  that trait uses internal statements or not, considering that as possible
</span><span class='line'>  incompatibilities with other usable traits.
</span></code></pre></td></tr></table></div></figure>


<p>So, this is our first example transformed as a friendly trait.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">namespace</span> <span class="nx">SomeProject</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * My trait</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">trait</span> <span class="nx">MyTrait</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Do something</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param \SomeProject\SomeObject\SomeObject $someObject Some object instance</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nx">\SomeProject\SomeObject\SomeObject</span> <span class="nv">$someObject</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Do things...</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Same trait, same behavior, but more friendly.
Have you ever had a problem related to this topic?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/28/composer-install-in-ci/">Composer Install in CI</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-09-28T16:53:00+02:00" pubdate data-updated="true">Sep 28<span>th</span>, 2015</time>
        
         | <a href="/blog/2015/09/28/composer-install-in-ci/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you have a project with a lot of dependencies, then you might now what I am
talking about. We all love composer, but we all know as well that, at least with
current PHP versions, some composer.json are very heavy to compute and fulfill.
All this problems are reduced to time, and some CI engines, like Travis, only
allow a finite number of seconds (in Travis case, 20 minutes).</p>

<p>That&rsquo;s too much!</p>

<p>I found a solution (at least, I thought), but some days ago I saw that was not a
solution at all, but a workaround that only sometimes works properly. I will
explain exactly what&rsquo;s the point here.</p>

<h3>The problem</h3>

<p>My <code>composer.json</code> is very big and composer needs too much time to compute all
the dependencies. Reducing dependencies is not an option at all, so the only way
of reducing dependencies is by doing some refactoring.</p>

<p>Any final project needs a lot of dependencies, and even if your <code>composer.json</code>
file is small, you may need a dependency with a lot of dependencies.</p>

<h3>My solution (the bad one&hellip;)</h3>

<p>This solution is only wrong if you want to test your application under several
PHP versions. That&rsquo;s my case and could be yours&hellip;</p>

<p>Well. Computing the real dependencies in my environment seems a great solution,
right? I run <code>composer update</code> in my computer, I update the <code>composer.lock</code>
version in the repository, and then I only need to do <code>composer install</code>. What
I reduce here is the computing time of all recursive dependencies from 20+
minutes to less than 5 minutes.</p>

<p>That&rsquo;s great!</p>

<h3>Why this is a bad solution?</h3>

<p>Some projects have decided to increase the minimum PHP dependency only
increasing the minor version of the package (and is not wrong, is not BC break).
If your project believes in Semantic Version (semver), is usual to find these
pieces of composer blocks</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="s2">&quot;require&quot;</span><span class="err">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;php&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;5.4&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;symfony/symfony&quot;</span><span class="p">:</span> <span class="s2">&quot;^2.7&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;doctrine/orm&quot;</span><span class="p">:</span> <span class="s2">&quot;^2.5&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;some/package&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.3&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If my development environment uses PHP 5.5, then I will be able to work with
this composer requirements. Great. We update our dependencies, we update our
repository with the <code>composer.lock</code> file, and everything should work as
expected.</p>

<p>The problem here is that there is an scenario that we are not considering here,
and is that for sure, our <code>composer.lock</code> is the result of computing the
<code>composer.json</code> file in PHP 5.5, but this doesn&rsquo;t mean that same dependencies
will work as well in PHP 5.4.</p>

<p>Let&rsquo;s see the <code>some/package</code> composer definition in version 1.3.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="s2">&quot;require&quot;</span><span class="err">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;php&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;5.4&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;whatever/whatever&quot;</span><span class="p">:</span> <span class="err">*</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then, let&rsquo;s see the same composer file in version 1.4.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="s2">&quot;require&quot;</span><span class="err">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;php&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;5.5&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;whatever/whatever&quot;</span><span class="p">:</span> <span class="err">*</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As long as we create the <code>composer.lock</code> file in our development environment
(remember, with PHP 5.5), we will use version 1.4 of package <code>some/package</code>, but
this package version is not compatible with PHP 5.4.</p>

<p>What will happens is that, when we do <code>composer install</code> in your CI, composer
will throw an Exception. And that&rsquo;s always bad news.</p>

<h3>The good solution</h3>

<p>There&rsquo;s no good solution at all. In fact, there are only partial solutions, for
example generating the <code>composer.lock</code> file with the highest PHP version
allowed, but then, if you work with a dependency that forces a PHP version in
each version, this won&rsquo;t work at all.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="s2">&quot;require&quot;</span><span class="err">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;php&quot;</span><span class="p">:</span> <span class="s2">&quot;5.4&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;whatever/whatever&quot;</span><span class="p">:</span> <span class="err">*</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, the only way of doing that is by using <code>composer update</code> in your CI
platform. The good point is that you <strong>must</strong> take care of your <code>composer.json</code>
file&hellip;</p>

<h3>For libraries</h3>

<p>If you work with a library, then use the biggest dependency scope. This will
allow more users to use your library. Of course, you will increase the final
time of composer computation time, but is not your problem at all.</p>

<p>Of course, library composer dependencies should be as small as possible.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="s2">&quot;require&quot;</span><span class="err">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;php&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;5.4&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;whatever/whatever&quot;</span><span class="p">:</span> <span class="err">*</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>For final projects</h3>

<p>Final projects have the responsibility of reducing that scope, only allowing
explicitly highest versions. Of course, final projects can host big composer
structures (at least it&rsquo;s not a bad practice&hellip;), so in that case you will have
to work harder to reduce that file.</p>

<p>The problem here is not a problem at all, so it has no sense to test your final
application under several PHP versions, at least in your CI platform. Just test
it under your current PHP version, right?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="s2">&quot;require&quot;</span><span class="err">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;php&quot;</span><span class="p">:</span> <span class="s2">&quot;5.5&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;whatever/whatever&quot;</span><span class="p">:</span> <span class="err">^</span><span class="mf">1.5</span><span class="err">.</span><span class="mi">4</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/14/symfony-ug-be-our-friend/">Symfony UG, Be Our Friend</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-09-14T10:57:00+02:00" pubdate data-updated="true">Sep 14<span>th</span>, 2015</time>
        
         | <a href="/blog/2015/09/14/symfony-ug-be-our-friend/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Symfony Barcelona UG have been looking some sponsors for a while, and we have
had a great response from the community. We are so proud and happy about that.</p>

<p>As a User Group, we want to be a community group for all the community, so from
today, you can be our UG friend :)</p>

<p>If you are a Symfony UG around the world and you want to be part of it, very
easy. Just send an email to
<a href="symfonybarcelona@gmail.com">symfonybarcelona@gmail.com</a> or just a simple tweet
with <a href="http://twitter.com/symfony_bcn">@symfony_bcn</a>. We will add your logo in
our website and you will appear in our next event.</p>

<p>Then, we will be friends :)</p>

<p>Please, share this post on your social networks, and help us making a better
world with tons of tiny and cute cats :)</p>

<p>Have a nice week!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/07/symfony-barcelona-event-september-2015/">Symfony Barcelona Event, September 2015</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-09-07T21:38:00+02:00" pubdate data-updated="true">Sep 7<span>th</span>, 2015</time>
        
         | <a href="/blog/2015/09/07/symfony-barcelona-event-september-2015/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It is a pleasure for me to announce that next September 22nd we will have a
great event in Barcelona. I&rsquo;ve talked many times about this local organization,
but this time is pretty different. I&rsquo;ll explain you.</p>

<p>This year Barcelona hosts the
<a href="https://events.drupal.org/barcelona2015">DrupalCon Europe 2015</a>, and this is
super exciting. Many people from around the world will visit our great and
amazing streets and will attend to a great and big event, related with Drupal,
Symfony and other interesting topics, always, related to the Drupal world.</p>

<p>This is very interesting from the point of view of Symfony, because as you may
know, new version of drupal, Drupal8, is build using some Symfony components.
This is one of the examples I refer when I talk about sharing technologies
between PHP projects and when I talk about open source, community and other
related topics. We&rsquo;ve seen these synergies between other PHP projects and
Symfony as well with Laravel, eZ Publish, Magento and Joomla (and many more,
indeed)</p>

<p>So, this is a call to all the community coming to Barcelona next September 21st.
We will host Fabien Potencier, the creator of Symfony, and Lukas Kahwe Smith, an
amazing and super active PHP developer, member, for example, of the PHP-FIG
group.</p>

<p><a href="http://symfony-barcelona.es">http://symfony-barcelona.es</a></p>

<p>Isn&rsquo;t it interesting? Indeed, but this is not all!</p>

<p>We are planning to overcome our last assistance record, which is 140 attendees.
This time, we want to fill an auditorium of 600 seats and show you what really
is Barcelona, and how amazing can be :)</p>

<p>Our sponsors are ready<br/>
The community is ready<br/>
The organization is ready<br/>
Only one thing is missing here&hellip;</p>

<p><strong>You!</strong></p>

<p><a href="http://symfony-barcelona.es#register">Join us now for free!</a> and please share
this post to allow everyone to know about it!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/08/28/eventlisteners-as-collectors-in-symfony/">EventListeners as Collectors in Symfony</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-08-28T12:04:00+02:00" pubdate data-updated="true">Aug 28<span>th</span>, 2015</time>
        
         | <a href="/blog/2015/08/28/eventlisteners-as-collectors-in-symfony/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some of my concerns during the last couple of years have been how to collect
data from all installed bundles using available tools in Symfony packages.
I say concerns because I don&rsquo;t really know if is there a tool for that.</p>

<p>Some people have told me that the
<a href="http://symfony.com/doc/current/components/event_dispatcher/introduction.html">EventDispatcher component</a>
can do this work greatly, but then I have the same question once and again&hellip; is
this component designed for such?</p>

<p>Let&rsquo;s review some tiny concepts here.</p>

<h2>Event immutability</h2>

<p>Try to think what really is an event. Something that happens. For example, I
wake up. Once I wake up, an event is dispatched called <code>mmoreram.wake_up</code>. This
event, of course, is immutable. Nothing can change the fact that I woke up, so
the event should be treated as an immutable object, with only reading actions.</p>

<p>One single property of the event is injected once is created. Did I wake up
rested enough for a new crazy day with all cool guys from my office?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">namespace</span> <span class="nx">Mmoreram</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\EventDispatcher\Event</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Marc woke up event</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">MmoreramWakeUpEvent</span> <span class="k">extends</span> <span class="nx">Event</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var boolean</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Marc woke up rested</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$rested</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Construct method</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var boolean $rested Marc woke up rested</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$rested</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rested</span> <span class="o">=</span> <span class="nv">$rested</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Get if Marc is rested enough</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return boolean Marc is rested enough</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">isRested</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rested</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Of course, no one should be able to change the value of rested, because no one
has the <strong>power</strong> to change the fact I woke up tired this night.</p>

<p>The main intention of an event is notify the world that something just happened,
so any extra implementation changing this paradigm should be avoided in order to
not corrupt the real meaning of the component.</p>

<p>Said that, and before continuing with the post&hellip; a question related to this
topic. Just make sure that you can take some time to think about that.</p>

<p>If we talk about decoupling between components&hellip; is the concept of <code>priority</code>
helpful? If any actor must know the priorities of all listeners in order to know
its own&hellip; then can we consider that all event listeners are really decoupled
between them? And how bad is that?</p>

<h2>Collector</h2>

<p>Let&rsquo;s figure out that the system need to collect some feelings when I wake up.
Let&rsquo;s figure out as well that we don&rsquo;t really care about how these feelings are
sorted, so the problem of priority is not a problem anymore: we can ignore it
completely.</p>

<p>We can change our event with this new implementation.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">namespace</span> <span class="nx">Mmoreram</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\EventDispatcher\Event</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Mmoreram\Feeling</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Marc woke up event</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">MmoreramWakeUpEvent</span> <span class="k">extends</span> <span class="nx">Event</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var boolean</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Marc woke up rested</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$rested</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var Feeling[]</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Array of feelings</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$feelings</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Construct method</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var boolean $rested Marc woke up rested</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$rested</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rested</span> <span class="o">=</span> <span class="nv">$rested</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">feelings</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Add new feeling</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param Feeling $feeling New feeling to be added</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return $this Self object</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">addFeeling</span><span class="p">(</span><span class="nx">Feeling</span> <span class="nv">$feeling</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">feelings</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$feeling</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Get if Marc is rested enough</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return boolean Marc is rested enough</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">isRested</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rested</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Get all feelings</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return Feeling[] Set of feelings</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getFeelings</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">feelings</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Of course, in our domain we must dispatch this event one I really wake up (for
example a service called <code>MmoreramVitalActions</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\EventDispatcher\EventDispatcher</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\EventDispatcher\Event</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Mmoreram\MmoreramWakeUpEvent</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Marc vital actions</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">MmoreramVitalActions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Marc wakes up</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return Feeling[] Set of feelings resulting of the action of waking up</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">wakeUp</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$rested</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">didMarcRestedProperly</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$eventDispatcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventDispatcher</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MmoreramWakeUpEvent</span><span class="p">(</span><span class="nv">$rested</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$dispatcher</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">dispatch</span><span class="p">(</span>
</span><span class='line'>                <span class="s1">&#39;mmoreram.wake_up&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="nv">$event</span>
</span><span class='line'>            <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getFeelings</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Get if Marc rested properly</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return boolean Marc rested properly</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">didMarcRestedProperly</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, after dispatching the event you should be able to get all
collected feelings. This means that the one in charge to fulfill this
information related to my feelings should be any event listener interested in
adding it&rsquo;s own related feeling.</p>

<p>For example, an Event Listener will have the responsibility to add a feeling
related to the temperature of my room.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">use</span> <span class="nx">Mmoreram\MmoreramWakeUpEvent</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Marc wake up event listener related to temperature.</span>
</span><span class='line'><span class="sd"> * This class is intended to add a feeling depending on local temperature</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">TemperatureMmoreramWakeUpEventListener</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Marc wakes up listener</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param MmoreramWakeUpEvent $event Marc wake up event</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return $this Self object</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">addTemperatureFeeling</span><span class="p">(</span><span class="nx">MmoreramWakeUpEvent</span> <span class="nv">$event</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$feeling</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getTemperatureFeeling</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">addFeeling</span><span class="p">(</span><span class="nv">$feeling</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Get feeling related to the temperature</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return Feeling Feeling related to temperature</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">getTemperatureFeeling</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Of course, you must add this event listener using tags in the Dependency
Injection Symfony configuration.</p>

<p><a href="http://symfony.com/doc/current/reference/dic_tags.html">Using tags for our listeners definition</a></p>

<p>At this point, you can see that maybe this is useful. This is a very easy and
fast collector implementation, but not enough good. The event is not immutable
anymore and you can change if from any event dispatcher, very far from the real
intention of the component.</p>

<h2>Solution</h2>

<p>I am using this approach in order to be as much pragmatic as possible. Of course
this works properly by adding an extra definition and documentation layer, but
I wonder if other people is concerned about that in Symfony.</p>

<p>I don&rsquo;t really think that yet another component called Collector would be
necessary at all unless there is an abstraction between both components (they
share some common things related to the fact of broadcasting and subscribing).</p>

<p>Of course, again, simple theory and personal thoughts brought to the community.
I will continue using this approach even knowing that should be solved using
another one as long as people understand it and is easy to work with.</p>

<p>Feedback and people thoughts will be appreciated, as always :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/08/23/symfony-in-barcelona/">Symfony in Barcelona</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-08-23T17:22:00+02:00" pubdate data-updated="true">Aug 23<span>rd</span>, 2015</time>
        
         | <a href="/blog/2015/08/23/symfony-in-barcelona/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Barcelona, one of the best cities in the world.</p>

<p>For you, Symfony lover. Do you know where is Barcelona, right?
Well, this is a call for all Symfony lovers who want something special,
something really different. Amazing people, amazing food and tons and tons of
new experiences with one of the greatest Symfony Communities around the world.</p>

<iframe width="1280" height="720" src="http://www.youtube.com/embed/6DxX1DYHOlk?feature=player_detailpage&VQ=HD720" frameborder="0" allowfullscreen></iframe>


<p>A lot of companies are actually being built in this city, so we really want you
with us. No matter your Symfony expertise, no matter how good you really are&hellip;
in Barcelona only matters one simple thing&hellip; How good you want to be. If you
want to be one of the bests, then Barcelona can be your new home :)</p>

<p>If you want to know more about it, just send an email to Symfony Barcelona User
Group and you will be properly helped to move here with us. The group email is
<a href="&#x6d;&#97;&#105;&#x6c;&#116;&#111;&#58;&#115;&#x79;&#109;&#x66;&#x6f;&#x6e;&#x79;&#x62;&#x61;&#114;&#99;&#101;&#x6c;&#111;&#110;&#97;&#x40;&#x67;&#x6d;&#97;&#x69;&#x6c;&#46;&#99;&#x6f;&#x6d;">&#115;&#121;&#x6d;&#102;&#x6f;&#110;&#x79;&#x62;&#x61;&#114;&#99;&#101;&#x6c;&#x6f;&#110;&#x61;&#x40;&#103;&#x6d;&#97;&#105;&#108;&#x2e;&#99;&#x6f;&#x6d;</a></p>

<p>You want to join us, but you don&rsquo;t know it yet :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/08/20/re-thinking-event-listeners/">Re-thinking Event Listeners</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-08-20T12:27:00+02:00" pubdate data-updated="true">Aug 20<span>th</span>, 2015</time>
        
         | <a href="/blog/2015/08/20/re-thinking-event-listeners/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Let&rsquo;s talk about Event Listeners.
Do you know what an Event Listener is?</p>

<p>Well, if you are used to working with Symfony, then you should know what is
intended for. If you don&rsquo;t, don&rsquo;t hesitate to take a look at the Symfony
documentation.</p>

<p>This post aims to start a small discussion about how an Event Listener should
look like if we really want to keep things decoupled.</p>

<h2>TL;DR</h2>

<ul>
<li>If we place our business logic inside the Event Listeners, we will not be able
to use this logic from other points, for example sending a &ldquo;Order created&rdquo; email
by hand from our Admin using a simple button.</li>
<li>What we could do is place ALL the logic inside a service that ONLY sends that
email, exposing a simple and documented api.</li>
<li>Then, considering that this service is injectable using any Dependency
Injection implementation, we can inject it into the Event Listener.</li>
<li>So, EventListeners are only a point of entry to your service layer</li>
</ul>


<h2>Using Event Listeners</h2>

<p>To understand what I am talking about, let&rsquo;s use an small example to make things
more clear&hellip;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Scenario: You buy something in an e-commerce, so, internally, your Cart became 
</span><span class='line'>an Order. Of course, and because user experience is important in that cases, you 
</span><span class='line'>want to send an email to the user with some Order information, so you need to 
</span><span class='line'>send an email to the Customer.
</span><span class='line'>
</span><span class='line'>Problem: You want to create this feature in a very decoupled way, of course. The
</span><span class='line'>e-commerce framework provides you that way, by proposing you an event once the
</span><span class='line'>Order is created. You can access the Order itself and the Customer.
</span><span class='line'>
</span><span class='line'>Solution: Create a new Event Listener object, subscribed to this event called
</span><span class='line'>order.oncreate, and sending that email.</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see a small example about how this Event Listener should look like. We
will follow the simple way, only focusing about sending that email in a
decoupled way with the action.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">class</span> <span class="nc">OrderEmailEventListener</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * We send an email to the Customer once an order is created</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param OrderOnCreatedEvent $event Event</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendEmail</span><span class="p">(</span><span class="nx">OrderOnCreatedEvent</span> <span class="nv">$event</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$order</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getOrder</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$customer</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getCustomer</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * Send the email</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And we could use this configuration in our bundle.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># Event Listeners</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="l-Scalar-Plain">project.event_listener.order_created_email</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">My\Bundle\EventListener\OrderCreatedEmailEventListener</span>
</span><span class='line'>        <span class="l-Scalar-Plain">tags</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">kernel.event_listener</span><span class="p-Indicator">,</span> <span class="nv">event</span><span class="p-Indicator">:</span> <span class="nv">order.oncreate</span><span class="p-Indicator">,</span> <span class="nv">method</span><span class="p-Indicator">:</span> <span class="nv">sendEmail</span> <span class="p-Indicator">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So this could be a simple implementation. I&rsquo;ve been using it since the beginning
of times as this could be considered a good practice. But, during this time
doing more and more Event Listeners, some questions have come to my mind.</p>

<h2>Decoupling from the Event</h2>

<p>Let&rsquo;s consider that our project has an admin panel. Of course, we should be able
to send this email any time we need (for example, our email server was down
during the order conversion and we must re-send it). Is this possible with this
implementation?</p>

<p>Yes. Let&rsquo;s do this considering that we have injected our EventListener and this
one is accessible locally!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OrderCreatedEmailEventListener</span><span class="p">(</span>
</span><span class='line'>    <span class="nv">$order</span><span class="p">,</span>
</span><span class='line'>    <span class="nv">$customer</span>
</span><span class='line'><span class="p">);</span>
</span><span class='line'><span class="nv">$orderCreatedEmailEventListener</span><span class="o">-&gt;</span><span class="na">sendEmail</span><span class="p">(</span><span class="nv">$event</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Well, this piece of code will really send the email&hellip; but is this
implementation enough right? I don&rsquo;t think so&hellip;</p>

<p>This Event should only be dispatched when the real event happens. It has no
sense to create a new <code>OrderEmailEventListener</code> instance without using the
event dispatcher. This means that, indeed, any Order has been created.</p>

<p>So first of all, creating a new Event out of turn, is not a good practice at
all.</p>

<p>For solving this, We could do that.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">class</span> <span class="nc">OrderCreatedEmailEventListener</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * We send an email to the Customer once an order is created</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param OrderOnCreatedEvent $event Event</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendEmail</span><span class="p">(</span><span class="nx">OrderOnCreatedEvent</span> <span class="nv">$event</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$order</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getOrder</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$customer</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getCustomer</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">sendOrderCreatedEmail</span><span class="p">(</span>
</span><span class='line'>            <span class="nv">$order</span><span class="p">,</span>
</span><span class='line'>            <span class="nv">$customer</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * We send an email to the Customer once an order is created, given the </span>
</span><span class='line'><span class="sd">     * order and the customer</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param OrderInterface    $order    Order</span>
</span><span class='line'><span class="sd">     * @param CustomerInterface $customer Customer</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendOrderCreatedEmail</span><span class="p">(</span>
</span><span class='line'>        <span class="nx">OrderInterface</span> <span class="nv">$order</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">CustomerInterface</span> <span class="nv">$customer</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * Send the email</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then, we could do this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$orderCreatedEmailEventListener</span><span class="o">-&gt;</span><span class="na">sendOrderCreatedEmail</span><span class="p">(</span>
</span><span class='line'>    <span class="nv">$order</span><span class="p">,</span>
</span><span class='line'>    <span class="nv">$customer</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Much better, right?
But is this good enough? No is not.</p>

<h2>Decoupling from the Listener</h2>

<p>We are using an instance of an Event Listener to send an email. Our analysis
could be exactly the same than before&hellip; Should we use an Event Listener even
when an event is not dispatched?</p>

<p>No we should not.</p>

<p>An Event Listener is an event listener. Listens one event, and that should be
all its work. So, we should never inject any event listener, anywhere. Let&rsquo;s do
some refactor here!</p>

<p>First of all, let&rsquo;s isolate our business logic in a new service. This service
will <strong>only</strong> do one thing; sending this email.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">class</span> <span class="nc">OrderCreatedEmailSender</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * We send an email to the Customer once an order is created, given the </span>
</span><span class='line'><span class="sd">     * order and the customer</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param OrderInterface    $order    Order</span>
</span><span class='line'><span class="sd">     * @param CustomerInterface $customer Customer</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendEmail</span><span class="p">(</span>
</span><span class='line'>        <span class="nx">OrderInterface</span> <span class="nv">$order</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">CustomerInterface</span> <span class="nv">$customer</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * Send the email</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This service has only one mission. Sending this email, no matter what event
executes it, no matter its environment. So if we take a look at what the Event
Listener implementation should look like now&hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">class</span> <span class="nc">OrderCreatedEmailEventListener</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var OrderCreatedEmailSender</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Order created email sender</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$orderCreatedEmailSender</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Constructor</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param OrderCreatedEmailSender $orderCreatedEmailSender</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">OrderCreatedEmailSender</span> <span class="nv">$orderCreatedEmailSender</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">orderCreatedEmailSender</span> <span class="o">=</span> <span class="nv">$orderCreatedEmailSender</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * We send an email to the Customer once an order is created</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param OrderOnCreatedEvent $event Event</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendEmail</span><span class="p">(</span><span class="nx">OrderOnCreatedEvent</span> <span class="nv">$event</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$order</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getOrder</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$customer</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getCustomer</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$this</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">orderCreatedEmailSender</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">sendEmail</span><span class="p">(</span>
</span><span class='line'>                <span class="nv">$order</span><span class="p">,</span>
</span><span class='line'>                <span class="nv">$customer</span>
</span><span class='line'>            <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, we should refactor as well the way we have defined our service in the
DependencyInjection config file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># Business layer</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="l-Scalar-Plain">project.business.order_created_email_sender</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">My\Bundle\Business\OrderCreatedEmailSender</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># Event Listeners</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="l-Scalar-Plain">project.event_listener.order_created_email</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">My\Bundle\EventListener\OrderCreatedEmailEventListener</span>
</span><span class='line'>        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="err">@</span><span class="l-Scalar-Plain">project.business.order_created_email_sender</span>
</span><span class='line'>        <span class="l-Scalar-Plain">tags</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">kernel.event_listener</span><span class="p-Indicator">,</span> <span class="nv">event</span><span class="p-Indicator">:</span> <span class="nv">order.oncreate</span><span class="p-Indicator">,</span> <span class="nv">method</span><span class="p-Indicator">:</span> <span class="nv">sendEmail</span> <span class="p-Indicator">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&rsquo;s all.
This example is so easy and simple, but I am sure that if you take a look at
your project, you will find a lot of logic inside your Event Listeners. Maybe
could be a good idea start moving all this logic out of the box, treating these
listeners as real entry points, like we do with our Commands, Controllers or
Twig extensions.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/18/defeating-expression-language/">Defeating Expression Language</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-05-18T09:53:00+02:00" pubdate data-updated="true">May 18<span>th</span>, 2015</time>
        
         | <a href="/blog/2015/05/18/defeating-expression-language/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>How beautiful Expression Language definitions are, right? I mean, inserting that
complex expressions in a Dependency Injection configuration file is so nice and
fast if you need to inject the result of a method in a service (one of the
multiple examples we can see)</p>

<p>Let&rsquo;s see a simple example of how we use this library.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># My managers</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="l-Scalar-Plain">some_manager</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">This\Is\My\Manager</span>
</span><span class='line'>        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="err">@</span><span class="l-Scalar-Plain">=service(&quot;another_manager&quot;).someCall(&quot;value&quot;)</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="err">@</span><span class="l-Scalar-Plain">=service(&quot;yet_another_manager&quot;).getInjectableInstance(parameter(&quot;my_parameter&quot;))</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is not a bad idea, really, but because we are engineers and we should have
as much information as possible in order to be able to choose between the best
option, always, I will show you another way of defining this piece of code.</p>

<p>Let&rsquo;s do that!</p>

<h3>Factories</h3>

<p>Remember the <a href="http://mmoreram.com/blog/2013/12/23/factory-pattern-in-symfony2/">Factory pattern in Symfony2</a>
post I wrote some time ago? I talked about how this pattern can be implemented
in your Symfony projects.</p>

<p>Well, just for your information, most of your Expression Language definitions
can be nicely done using Factories.</p>

<p>Let&rsquo;s reproduce the same example using factories.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="c1"># My managers</span>
</span><span class='line'>    <span class="c1">#</span>
</span><span class='line'>    <span class="l-Scalar-Plain">some_manager</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">This\Is\My\Manager</span>
</span><span class='line'>        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="err">@</span><span class="l-Scalar-Plain">my_injectable_value</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="err">@</span><span class="l-Scalar-Plain">my_injectable_service</span>
</span><span class='line'>
</span><span class='line'>    <span class="l-Scalar-Plain">my_injectable_value</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">StdClass</span>
</span><span class='line'>        <span class="l-Scalar-Plain">factory</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="err">@</span><span class="l-Scalar-Plain">another_manager</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">someCall</span>
</span><span class='line'>        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">value</span>
</span><span class='line'>
</span><span class='line'>    <span class="l-Scalar-Plain">my_injectable_service</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">This\Is\My\Injectable\Class</span>
</span><span class='line'>        <span class="l-Scalar-Plain">factory</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="err">@</span><span class="l-Scalar-Plain">yet_another_manager</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">getInjectableInstance</span>
</span><span class='line'>        <span class="l-Scalar-Plain">arguments</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="p-Indicator">-</span> <span class="err">%</span><span class="l-Scalar-Plain">my_parameter%</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Dependency</h3>

<p>Take a look and realise that we&rsquo;ve removed a package dependency from your
project, as you don&rsquo;t need <code>symfony/expression-language</code> anymore, and your DIC
definition will be easily exportable to another format if someday is needed.</p>

<h3>Reflexion</h3>

<p>Is Expression Language a bad choice? Well, only you should be able to know if
using this library is a good choice or not, because only you know your needs and
your resources, but every time you add a new Expression Language line, just ask
yourself&hellip;</p>

<p>Can I use simple DI definitions here? Is the only way I can do that?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/08/crowdfunding-soundtrack-the-event/">Crowdfunding Soundtrack - El Evento</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-05-08T17:29:00+02:00" pubdate data-updated="true">May 8<span>th</span>, 2015</time>
        
         | <a href="/blog/2015/05/08/crowdfunding-soundtrack-the-event/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>This post is written in Spanish, but I will translate it soon. Stay tuned for
the translation :D</p></blockquote>

<p>Finalmente, y despuÃ©s de unas semanas cociendo la idea, valorando pros y contras
y el impacto que puede tener en mi vida personal lo que os voy a contar, he
decidido tirar para delante la idea mÃ¡s estÃºpida que se me ha podido ocurrir en
los 29 aÃ±os de edad que tengo.</p>

<p>En pocas palabras, a modo introductorio y declarativo.</p>

<p>La idea es hacer una iniciativa CrowdFunding durante un periodo de 3 meses y
conseguir el dinero suficiente para cumplir los siguientes objetivos.</p>

<ul>
<li>Dado una <a href="http://open.spotify.com/user/mmoreramerino/playlist/76u4iXLIFxO3PMFWfwYk5A">lista de spotify</a>
donde he agrupado mis temas favoritos de bandas sonoras, que una Orquestra
SinfÃ³nica interprete los temas en un evento pÃºblico.</li>
<li>Yo, por mi parte, estudiar durante un periodo de tiempo direcciÃ³n de orquestra
bÃ¡sico. Evidentemente lo justo para entender los conceptos necesarios y
defenderme.</li>
<li>Dirigir yo, personalmente, uno de los temas.</li>
<li>Donar absolutamente todo el dinero que se recaude en el evento (entradas,
dinero que no se haya gastado despuÃ©s de la iniciativa) al desarrollo y la
investigaciÃ³n de la sordera. AÃºn estoy buscando organizaciÃ³n, universidad o
instituto.</li>
<li>Cumplir uno de mis retos personales, y con ello, ayudar a que otros cumplan
los suyos.</li>
</ul>


<p>Si en este punto sigues leyendo sin pensar que estoy mal de la cabeza,
recapacita; lo estoy. AÃºn asÃ­, eso no deberÃ­a impedir que uno haga lo que
realmente quiere hacer, pues <em>que serÃ­amos sin sueÃ±os estÃºpidos, solo estÃºpidos
sin sueÃ±os</em>.</p>

<h2>Los temas musicales</h2>

<p>PodÃ©is encontrar el enlace de la lista de Spotify en el parÃ¡grafo anterior (debo
decir que falta un track de &ldquo;La Roca&rdquo; inexistente en Spotify. A continuaciÃ³n
adjunto dicha lista.</p>

<ul>
<li>The chase &ndash; The Rock</li>
<li>I don&rsquo;t think now it the best time &ndash; Pirates of the Caribbean &ndash; At world&rsquo;s end</li>
<li>A dark knight &ndash; The dark knight</li>
<li>Flight &ndash; Man of Steel</li>
<li>Comming back around &ndash; How to train your dragon</li>
<li>Spectres in the fog &ndash; The last samurai</li>
<li>The all spark &ndash; Transformers</li>
<li>My name is Lincoln &ndash; The island</li>
<li>War &ndash; Pearl Harbor</li>
<li>Chevaliers de Sangreal &ndash; The Da Vinci Code</li>
<li>Sound the Buggle now &ndash; Spirit, Stallion of the Cimarron</li>
<li>Run Free &ndash; Spirit, Stallion of the Cimarron</li>
<li>The Wheat &ndash; Gladiator</li>
<li>The Battle &ndash; Gladiator</li>
</ul>


<p>Cada uno de estos temas compone la banda sonora de mi vida.</p>

<h2>Crowdfunding</h2>

<p>Algunos os preguntarÃ©is&hellip; bueno Marc, y todo esto cuanto vale? Pues aÃºn estoy
trabajando en ello, pero es bastante dinero. Calculo que alrededor de unos
200.000 euros para ser especÃ­ficos.</p>

<p>No tengo aÃºn muy claro como voy a configurar los niveles de colaboraciÃ³n
(hay distintos mÃ­nimos de aportaciones, y cada uno de ellos te proporciona un
retorno de cierto nivel. En este caso el retorno serÃ¡ reducido para maximizar el
volumen de donaciÃ³n final)</p>

<p>Lo que si tengo claro es el tipo de pÃºblico al que va la iniciativa.</p>

<ul>
<li>Patrocinadores &ndash; Empresas que quieran hacer que esto sea posible. SerÃ¡n los
niveles de patrocinio mÃ¡s altos.</li>
<li>Individuales &ndash; Todo aquel que quiera hacer una donaciÃ³n a la investigaciÃ³n y
quiera que el evento ocurra podrÃ¡ hacerlo mediante dicho evento. A partir de uno
de los niveles de patrocinio, habrÃ¡ entrada gratuita al evento.</li>
<li>Aportaciones &ndash; Fuera del evento crowdfunding tambiÃ©n se aceptarÃ¡n donaciones,
aunque es preferible que todas entren por el evento.</li>
</ul>


<h2>La plataforma</h2>

<p>Finalmente, y despuÃ©s de solucionar un dilema mental que tenÃ­a entre si hacerlo
internacional o local, he decidido ejecutar el evento a nivel espaÃ±ol. Para esto
tratarÃ© de utilizar la plataforma <a href="http://www.verkami.com/">Verkami</a> dado que
tengo muy buenas referencias.</p>

<h2>El porquÃ©</h2>

<p>En realidad, Ãºltimamente estoy hablando mucho de emprendedores y de intentar
todo aquello que crees que deberÃ­as intentar. La idea de hacer eventos me gusta
mucho, de hecho soy organizador de un evento en Barcelona bastante chulo, aunque
local, por el momento.</p>

<p>El hecho tambiÃ©n que me guste la mÃºsica hasta lÃ­mites indecentes hace que quiera
poner toda la carne en el asador, sin preguntarme demasiado el porquÃ© hago todo
esto. Creo ser un mÃºsico frustrado y siempre me quedarÃ¡ el intentar, por todos
los medios posibles e imposibles, cumplir alguno de mis hitos indiscutibles.</p>

<p>El dirigir una orquestra es uno de ellos. Desde hace muchos aÃ±os.</p>

<p>Y como he dicho alguna vez, el mejor consejo que me han dado nunca en mi vida ha
sido &ldquo;No lo intentes&rdquo;, por lo que, haciendo caso omiso a las personas vacÃ­as de
locura, no lo voy a intentar, lo voy a hacer.</p>

<h2>PrÃ³ximos pasos</h2>

<ul>
<li>En unos dÃ­as voy a colgar la iniciativa en Verkami.</li>
<li>Hacer ruido. Mucho ruido. Demostrar que todo es posible.</li>
<li>Buscar organizaciÃ³n o similar para donar todo el dinero ganado.</li>
<li>Trabajar bien el evento y todas las piezas componen organizar un
acontecimiento de estas caracterÃ­sticas.</li>
<li>Encontrar un grupo de gente motivada con la idea que quiera ayudarme una vez
se cierre la iniciativa con resultado positivo.</li>
<li>Seguir trabajando en la idea, hasta el final.</li>
</ul>


<p>Si quieres estar actualizado sobre el evento, puedes seguir-me en
<a href="http://twitter.com/mmoreram">Twitter</a> o suscribirte a mi blog, desde donde voy
a escribir de forma periÃ³dica todas las actualizaciones sobre el evento.</p>

<p>Saludos a todos.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/08/lazy-commands-in-symfony/">Lazy Commands in Symfony</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-05-08T11:04:00+02:00" pubdate data-updated="true">May 8<span>th</span>, 2015</time>
        
         | <a href="/blog/2015/05/08/lazy-commands-in-symfony/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Have you ever had this scenario?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>php app/console doctrine:database:drop --force
</span><span class='line'><span class="nv">$ </span>php app/console doctrine:database:create
</span><span class='line'>
</span><span class='line'>    <span class="o">[</span>Doctrine<span class="se">\D</span>BAL<span class="se">\E</span>xception<span class="se">\C</span>onnectionException<span class="o">]</span>
</span><span class='line'>    An exception occured in driver: SQLSTATE<span class="o">[</span>42000<span class="o">]</span> <span class="o">[</span>1049<span class="o">]</span> Unknown database <span class="s1">&#39;mydatabase&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Well, it happens and I will tell you why.</p>

<h2>Command as a Service</h2>

<p>Since Symfony version 2.4 you can define your controllers and commands as
services. This is so useful as long as you need to treat your classes as much
decoupled as possible. You can check some information about how to define them
as services in
<a href="http://symfony.com/doc/current/cookbook/console/commands_as_services.html">Symfony Documentation</a>.</p>

<p>Then, let&rsquo;s figure out that our command is intended to check an entity from your
database. Of course, your command should be as empty as possible, placing all
your business logic inside your service layer (this is not the only strategy, of
course, but there is no strategy where you lace your logic inside your command).</p>

<p>Then, using commands as services, you will have this</p>

<ul>
<li>ObjectManager as a service (or Repository)</li>
<li>Your service, intended to do whatever you need to do, for example, check that
your entities are all enabled. Your ObjectManager or Repository will be injected
here</li>
<li>Your command, intended to work as the simple layer between your cli interface
and your service layer. Your service will be injected here.</li>
</ul>


<p>Given this schema, when we require this command through the DI Container, of
course a new Service instance will be created in order to inject it through the
command constructor, and the object will have to be created as well to be
injected inside the service.</p>

<p>It means create a new connection to the database. Fair enough till now :)</p>

<h2>Commands list</h2>

<p>Let me show you some lines of code. This method is placed in a class called
<code>Application</code> inside the bundle <code>FrameworkBundle</code>. This class is intended to add
the possibility of adding Commands as services in the main Application class of
Command Component.</p>

<p><a href="https://github.com/symfony/symfony/blob/2.7/src/Symfony/Bundle/FrameworkBundle/Console/Application.php">Symfony\Bundle\FrameworkBundle\Console\Application</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">protected</span> <span class="k">function</span> <span class="nf">registerCommands</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$container</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">kernel</span><span class="o">-&gt;</span><span class="na">getContainer</span><span class="p">();</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">kernel</span><span class="o">-&gt;</span><span class="na">getBundles</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$bundle</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$bundle</span> <span class="nx">instanceof</span> <span class="nx">Bundle</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$bundle</span><span class="o">-&gt;</span><span class="na">registerCommands</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">hasParameter</span><span class="p">(</span><span class="s1">&#39;console.command.ids&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="s1">&#39;console.command.ids&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Oh, wait&hellip; what?</p>

<p>Register a command means instantiate it! So if we have a command with a service
injected which has an object manager injected&hellip; then we have a problem. If we
don&rsquo;t have the database created we will not be able to create it using the
Doctrine command.</p>

<p><em>~ironic~ Perfect scenario for deployment ~/ironic~</em></p>

<h2>Using Lazy services</h2>

<p>Of course we should find a solution for this scenario, in order to be able to
call this command when is needed.</p>

<p>When we define as lazy a service, this is not instanced when is injected, but
only when is accessed. You can find some information about lazy services in
<a href="http://symfony.com/doc/current/components/dependency_injection/lazy_services.html">Symfony Documentation</a>.</p>

<p>The point here is to define our service intended to work with the model as lazy.
The result will be that when we instance the Command, then a proxy object is
created and injected with all the service information.</p>

<p>Because our command will not be used as long as we don&rsquo;t need it, then the
service will not be instanced and the ObjectManager not created. We will be able
to list all the commands, and finally, call
<code>php app/console doctrine:database:create</code> properly.</p>

<h2>Implementation</h2>

<p>Some tips here&hellip;</p>

<ul>
<li>Why instancing all services when we just need them to be listed? Is it really
necessary? Doing than we are forcing some service to be defined as lazy just
because of it, and this is not and will never be a good practice.</li>
<li>If the command needs to be instanced to be listed, and assuming that this
information <del>should</del> could be cached, then, is it necessary to call the
constructor? We could get the class, build the object using <code>\ReflectionClass</code>
and request all the needed information.</li>
</ul>


<p>I invoke the community for some feedback on that. If this is really a need for
some people, we should do some push (and organize us for an implementation,
maybe) to change this implementation for next Symfony 3 version.</p>

<p>Feedback, feedback :)</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/10/16/namespaces-in-traits/">Namespaces in Traits</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/28/composer-install-in-ci/">Composer install in CI</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/14/symfony-ug-be-our-friend/">Symfony UG, be our friend</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/07/symfony-barcelona-event-september-2015/">Symfony Barcelona Event, September 2015</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/28/eventlisteners-as-collectors-in-symfony/">EventListeners as collectors in Symfony</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/mmoreram">@mmoreram</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mmoreram',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

      </div>
    </div>
    <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Marc Morera -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>. Design by <a href="http://octopressthemes.com">Octopress Themes</a>.</span>
</p>

</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'mmoreram';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </div>
</body>
</html>
